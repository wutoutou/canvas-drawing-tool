{"version":3,"file":"canvas-drawing-tool.umd.js","sources":["../src/core/event-manager.js","../src/shapes/Shape.js","../src/shapes/rectangle.js","../src/shapes/circle.js","../src/shapes/polygon.js","../src/shapes/brush.js","../src/shapes/shape-factory.js","../src/core/canvas-drawer.js","../src/utils/geometry.js","../src/utils/helpers.js","../src/tools/base-tool.js","../src/tools/brush-tool.js","../src/tools/rectangle-tool.js","../src/tools/circle-tool.js","../src/tools/polygon-tool.js","../src/tools/select-tool.js","../src/index.js"],"sourcesContent":["export default class EventManager {\r\n  constructor() {\r\n    this.events = new Map();\r\n  }\r\n\r\n  on(event, callback) {\r\n    if (!this.events.has(event)) {\r\n      this.events.set(event, new Set());\r\n    }\r\n    this.events.get(event).add(callback);\r\n  }\r\n\r\n  off(event, callback) {\r\n    if (this.events.has(event)) {\r\n      this.events.get(event).delete(callback);\r\n    }\r\n  }\r\n\r\n  emit(event, data) {\r\n    if (this.events.has(event)) {\r\n      this.events.get(event).forEach(callback => {\r\n        try {\r\n          callback(data);\r\n        } catch (error) {\r\n          console.error(`Error in event handler for ${event}:`, error);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.events.clear();\r\n  }\r\n}\r\n","export default class Shape {\r\n  constructor(id, type, data) {\r\n    this.id = id;\r\n    this.type = type;\r\n    this.data = data;\r\n  }\r\n\r\n  draw(ctx) {\r\n    // 子类实现具体绘制逻辑\r\n  }\r\n\r\n  containsPoint(point) {\r\n    // 子类实现点击检测逻辑\r\n    return false;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      id: this.id,\r\n      type: this.type,\r\n      data: { ...this.data }\r\n    };\r\n  }\r\n\r\n  static fromJSON(json) {\r\n    return new Shape(json.id, json.type, json.data);\r\n  }\r\n}\r\n","import Shape from './Shape.js';\r\n\r\nexport default class Rectangle extends Shape {\r\n  constructor(id, data) {\r\n    super(id, 'rectangle', data);\r\n  }\r\n\r\n  draw(ctx) {\r\n    ctx.save();\r\n    ctx.strokeStyle = this.data.color;\r\n    ctx.lineWidth = this.data.lineWidth;\r\n    ctx.strokeRect(this.data.x, this.data.y, this.data.width, this.data.height);\r\n    ctx.restore();\r\n  }\r\n\r\n  containsPoint(point, tolerance = 5) {\r\n    const { x, y, width, height } = this.data;\r\n    return point.x >= x - tolerance && \r\n           point.x <= x + width + tolerance && \r\n           point.y >= y - tolerance && \r\n           point.y <= y + height + tolerance;\r\n  }\r\n}\r\n","import Shape from './Shape.js';\r\n\r\nexport default class Circle extends Shape {\r\n  constructor(id, data) {\r\n    super(id, 'circle', data);\r\n  }\r\n\r\n  draw(ctx) {\r\n    ctx.save();\r\n    ctx.strokeStyle = this.data.color;\r\n    ctx.lineWidth = this.data.lineWidth;\r\n    ctx.beginPath();\r\n    ctx.arc(this.data.x, this.data.y, this.data.radius, 0, Math.PI * 2);\r\n    ctx.stroke();\r\n    ctx.restore();\r\n  }\r\n\r\n  containsPoint(point, tolerance = 5) {\r\n    const { x, y, radius } = this.data;\r\n    const distance = Math.sqrt((point.x - x) ** 2 + (point.y - y) ** 2);\r\n    return distance <= radius + tolerance;\r\n  }\r\n}\r\n","import Shape from './Shape.js';\r\n\r\nexport default class Polygon extends Shape {\r\n  constructor(id, data) {\r\n    super(id, 'polygon', data);\r\n  }\r\n\r\n  draw(ctx) {\r\n    if (this.data.points.length < 3) return;\r\n\r\n    ctx.save();\r\n    ctx.strokeStyle = this.data.color;\r\n    ctx.lineWidth = this.data.lineWidth;\r\n    ctx.beginPath();\r\n    ctx.moveTo(this.data.points[0].x, this.data.points[0].y);\r\n    \r\n    for (let i = 1; i < this.data.points.length; i++) {\r\n      ctx.lineTo(this.data.points[i].x, this.data.points[i].y);\r\n    }\r\n    \r\n    ctx.closePath();\r\n    ctx.stroke();\r\n    ctx.restore();\r\n  }\r\n\r\n  containsPoint(point, tolerance = 5) {\r\n    const { points } = this.data;\r\n    if (points.length < 3) return false;\r\n\r\n    // 使用射线法判断点是否在多边形内\r\n    let inside = false;\r\n    for (let i = 0, j = points.length - 1; i < points.length; j = i++) {\r\n      const xi = points[i].x, yi = points[i].y;\r\n      const xj = points[j].x, yj = points[j].y;\r\n      \r\n      const intersect = ((yi > point.y) !== (yj > point.y)) &&\r\n        (point.x < (xj - xi) * (point.y - yi) / (yj - yi) + xi);\r\n      \r\n      if (intersect) inside = !inside;\r\n    }\r\n    \r\n    return inside;\r\n  }\r\n}\r\n","import Shape from './Shape.js';\r\n\r\nexport default class Brush extends Shape {\r\n  constructor(id, data) {\r\n    super(id, 'brush', data);\r\n  }\r\n\r\n  draw(ctx) {\r\n    if (this.data.points.length < 2) return;\r\n\r\n    ctx.save();\r\n    ctx.strokeStyle = this.data.color;\r\n    ctx.lineWidth = this.data.lineWidth;\r\n    ctx.beginPath();\r\n    ctx.moveTo(this.data.points[0].x, this.data.points[0].y);\r\n    \r\n    for (let i = 1; i < this.data.points.length; i++) {\r\n      ctx.lineTo(this.data.points[i].x, this.data.points[i].y);\r\n    }\r\n    \r\n    ctx.stroke();\r\n    ctx.restore();\r\n  }\r\n\r\n  containsPoint(point, tolerance = 5) {\r\n    const { points, lineWidth } = this.data;\r\n    if (points.length < 2) return false;\r\n\r\n    // 检查点是否在笔划附近\r\n    for (let i = 1; i < points.length; i++) {\r\n      const prev = points[i - 1];\r\n      const curr = points[i];\r\n      \r\n      const distance = this._pointToLineDistance(point, prev, curr);\r\n      if (distance <= lineWidth / 2 + tolerance) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  _pointToLineDistance(point, lineStart, lineEnd) {\r\n    const A = point.x - lineStart.x;\r\n    const B = point.y - lineStart.y;\r\n    const C = lineEnd.x - lineStart.x;\r\n    const D = lineEnd.y - lineStart.y;\r\n\r\n    const dot = A * C + B * D;\r\n    const lenSq = C * C + D * D;\r\n    let param = -1;\r\n    \r\n    if (lenSq !== 0) param = dot / lenSq;\r\n\r\n    let xx, yy;\r\n\r\n    if (param < 0) {\r\n      xx = lineStart.x;\r\n      yy = lineStart.y;\r\n    } else if (param > 1) {\r\n      xx = lineEnd.x;\r\n      yy = lineEnd.y;\r\n    } else {\r\n      xx = lineStart.x + param * C;\r\n      yy = lineStart.y + param * D;\r\n    }\r\n\r\n    const dx = point.x - xx;\r\n    const dy = point.y - yy;\r\n    return Math.sqrt(dx * dx + dy * dy);\r\n  }\r\n}\r\n","import Rectangle from './rectangle.js';\r\nimport Circle from './circle.js';\r\nimport Polygon from './polygon.js';\r\nimport Brush from './brush.js';\r\n\r\nexport class ShapeFactory {\r\n  static createShape(shapeData) {\r\n    const { type, data, id } = shapeData;\r\n    \r\n    switch (type) {\r\n      case 'rectangle':\r\n        return new Rectangle(id, data);\r\n      case 'circle':\r\n        return new Circle(id, data);\r\n      case 'polygon':\r\n        return new Polygon(id, data);\r\n      case 'brush':\r\n        return new Brush(id, data);\r\n      default:\r\n        console.warn(`Unknown shape type: ${type}`);\r\n        return null;\r\n    }\r\n  }\r\n\r\n  static createShapeFromJSON(json) {\r\n    return this.createShape(json);\r\n  }\r\n}\r\n","import EventManager from \"./event-manager.js\";\r\nimport { ShapeFactory } from \"../shapes\";\r\n\r\nexport default class CanvasDrawer {\r\n  constructor(container, config) {\r\n    this.container = container;\r\n    this.config = config;\r\n    this.canvas = null;\r\n    this.ctx = null;\r\n    this.shapes = new Map();\r\n    this.eventManager = new EventManager();\r\n    this.isDrawing = false;\r\n\r\n    this._initializeCanvas();\r\n    this._bindEvents();\r\n  }\r\n\r\n  _initializeCanvas() {\r\n    // 创建 canvas 元素\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.canvas.width = this.config.width;\r\n    this.canvas.height = this.config.height;\r\n    this.canvas.style.backgroundColor = this.config.backgroundColor;\r\n    this.canvas.style.cursor = \"crosshair\";\r\n\r\n    this.container.appendChild(this.canvas);\r\n    this.ctx = this.canvas.getContext(\"2d\");\r\n\r\n    // 设置默认样式\r\n    this.currentColor = this.config.defaultColor;\r\n    this.currentLineWidth = this.config.defaultLineWidth;\r\n  }\r\n\r\n  _bindEvents() {\r\n    this.canvas.addEventListener(\"mousedown\", this._handleMouseDown.bind(this));\r\n    this.canvas.addEventListener(\"mousemove\", this._handleMouseMove.bind(this));\r\n    this.canvas.addEventListener(\"mouseup\", this._handleMouseUp.bind(this));\r\n    this.canvas.addEventListener(\r\n      \"dblclick\",\r\n      this._handleDoubleClick.bind(this)\r\n    );\r\n  }\r\n\r\n  _handleMouseDown(event) {\r\n    const point = this._getMousePosition(event);\r\n    this.eventManager.emit(\"mousedown\", { point, event });\r\n  }\r\n\r\n  _handleMouseMove(event) {\r\n    const point = this._getMousePosition(event);\r\n    this.eventManager.emit(\"mousemove\", { point, event });\r\n  }\r\n\r\n  _handleMouseUp(event) {\r\n    const point = this._getMousePosition(event);\r\n    this.eventManager.emit(\"mouseup\", { point, event });\r\n  }\r\n\r\n  _handleDoubleClick(event) {\r\n    const point = this._getMousePosition(event);\r\n    this.eventManager.emit(\"dblclick\", { point, event });\r\n  }\r\n\r\n  _getMousePosition(event) {\r\n    const rect = this.canvas.getBoundingClientRect();\r\n    return {\r\n      x: event.clientX - rect.left,\r\n      y: event.clientY - rect.top,\r\n    };\r\n  }\r\n\r\n  setColor(color) {\r\n    this.currentColor = color;\r\n    this.ctx.strokeStyle = color;\r\n  }\r\n\r\n  setLineWidth(width) {\r\n    this.currentLineWidth = width;\r\n    this.ctx.lineWidth = width;\r\n  }\r\n\r\n  clear() {\r\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.shapes.clear();\r\n    this.eventManager.clear();\r\n    this.eventManager.emit(\"clear\");\r\n  }\r\n\r\n  addShape(shapeData) {\r\n    const shape = ShapeFactory.createShape(shapeData);\r\n    if (shape) {\r\n      this.shapes.set(shape.id, shape);\r\n      this._redraw();\r\n      this.eventManager.emit(\"shapeAdded\", { shape });\r\n    }\r\n  }\r\n\r\n  removeShape(shapeId) {\r\n    if (this.shapes.has(shapeId)) {\r\n      const shape = this.shapes.get(shapeId);\r\n      this.shapes.delete(shapeId);\r\n      this._redraw();\r\n      this.eventManager.emit(\"shapeRemoved\", { shape });\r\n    }\r\n  }\r\n\r\n  getShapes() {\r\n    return Array.from(this.shapes.values());\r\n  }\r\n\r\n  getShape(shapeId) {\r\n    return this.shapes.get(shapeId);\r\n  }\r\n\r\n  _redraw() {\r\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n    // 绘制所有图形\r\n    this.shapes.forEach((shape) => {\r\n      shape.draw(this.ctx);\r\n    });\r\n  }\r\n\r\n  exportImage(format = \"image/png\", quality = 1.0) {\r\n    return this.canvas.toDataURL(format, quality);\r\n  }\r\n\r\n  importData(shapesData) {\r\n    this.clear();\r\n    shapesData.forEach((shapeData) => {\r\n      this.addShape(shapeData);\r\n    });\r\n  }\r\n\r\n  exportData() {\r\n    return this.getShapes().map((shape) => shape.toJSON());\r\n  }\r\n\r\n  on(event, callback) {\r\n    this.eventManager.on(event, callback);\r\n  }\r\n\r\n  off(event, callback) {\r\n    this.eventManager.off(event, callback);\r\n  }\r\n\r\n  resetEvent() {\r\n    this.eventManager.clear();\r\n  }\r\n\r\n  destroy() {\r\n    this.canvas.remove();\r\n    this.eventManager.clear();\r\n  }\r\n\r\n  /**\r\n   * 设置画布尺寸\r\n   */\r\n  setSize(width, height) {\r\n    // 保存当前内容\r\n    const currentImage = this.getDataUrl();\r\n\r\n    // 调整画布尺寸\r\n    this.canvas.width = width;\r\n    this.canvas.height = height;\r\n\r\n    // 重新绘制内容\r\n    const img = new Image();\r\n    img.onload = () => {\r\n      this.ctx.fillStyle = this.config.backgroundColor;\r\n      this.ctx.fillRect(0, 0, width, height);\r\n      this.ctx.drawImage(img, 0, 0);\r\n    };\r\n    img.src = currentImage;\r\n  }\r\n\r\n  /**\r\n   * 设置背景颜色\r\n   */\r\n  setBackgroundColor(color) {\r\n    this.config.backgroundColor = color;\r\n    const currentImage = this.getDataUrl();\r\n\r\n    this.ctx.fillStyle = color;\r\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n    const img = new Image();\r\n    img.onload = () => {\r\n      this.ctx.drawImage(img, 0, 0);\r\n    };\r\n    img.src = currentImage;\r\n  }\r\n\r\n  /**\r\n   * 获取画布数据URL\r\n   */\r\n  getDataUrl(type = \"image/png\", quality = 1) {\r\n    return this.canvas.toDataURL(type, quality);\r\n  }\r\n}\r\n","/**\r\n * 几何计算工具函数\r\n */\r\n\r\n/**\r\n * 计算两点之间的距离\r\n */\r\nexport function distance(point1, point2) {\r\n  const dx = point2.x - point1.x;\r\n  const dy = point2.y - point1.y;\r\n  return Math.sqrt(dx * dx + dy * dy);\r\n}\r\n\r\n/**\r\n * 计算点到线段的距离\r\n */\r\nexport function pointToLineDistance(point, lineStart, lineEnd) {\r\n  const A = point.x - lineStart.x;\r\n  const B = point.y - lineStart.y;\r\n  const C = lineEnd.x - lineStart.x;\r\n  const D = lineEnd.y - lineStart.y;\r\n\r\n  const dot = A * C + B * D;\r\n  const lenSq = C * C + D * D;\r\n  let param = -1;\r\n  \r\n  if (lenSq !== 0) param = dot / lenSq;\r\n\r\n  let xx, yy;\r\n\r\n  if (param < 0) {\r\n    xx = lineStart.x;\r\n    yy = lineStart.y;\r\n  } else if (param > 1) {\r\n    xx = lineEnd.x;\r\n    yy = lineEnd.y;\r\n  } else {\r\n    xx = lineStart.x + param * C;\r\n    yy = lineStart.y + param * D;\r\n  }\r\n\r\n  const dx = point.x - xx;\r\n  const dy = point.y - yy;\r\n  return Math.sqrt(dx * dx + dy * dy);\r\n}\r\n\r\n/**\r\n * 判断点是否在多边形内（射线法）\r\n */\r\nexport function isPointInPolygon(point, polygonPoints) {\r\n  if (polygonPoints.length < 3) return false;\r\n\r\n  let inside = false;\r\n  for (let i = 0, j = polygonPoints.length - 1; i < polygonPoints.length; j = i++) {\r\n    const xi = polygonPoints[i].x, yi = polygonPoints[i].y;\r\n    const xj = polygonPoints[j].x, yj = polygonPoints[j].y;\r\n    \r\n    const intersect = ((yi > point.y) !== (yj > point.y)) &&\r\n      (point.x < (xj - xi) * (point.y - yi) / (yj - yi) + xi);\r\n    \r\n    if (intersect) inside = !inside;\r\n  }\r\n  \r\n  return inside;\r\n}\r\n\r\n/**\r\n * 计算多边形中心点\r\n */\r\nexport function getPolygonCenter(points) {\r\n  if (points.length === 0) return { x: 0, y: 0 };\r\n  \r\n  const centerX = points.reduce((sum, p) => sum + p.x, 0) / points.length;\r\n  const centerY = points.reduce((sum, p) => sum + p.y, 0) / points.length;\r\n  \r\n  return { x: centerX, y: centerY };\r\n}\r\n\r\n/**\r\n * 计算矩形边界框\r\n */\r\nexport function getBoundingBox(points) {\r\n  if (points.length === 0) return { x: 0, y: 0, width: 0, height: 0 };\r\n  \r\n  const xs = points.map(p => p.x);\r\n  const ys = points.map(p => p.y);\r\n  \r\n  const minX = Math.min(...xs);\r\n  const maxX = Math.max(...xs);\r\n  const minY = Math.min(...ys);\r\n  const maxY = Math.max(...ys);\r\n  \r\n  return {\r\n    x: minX,\r\n    y: minY,\r\n    width: maxX - minX,\r\n    height: maxY - minY\r\n  };\r\n}\r\n\r\n/**\r\n * 判断两个矩形是否相交\r\n */\r\nexport function isRectIntersect(rect1, rect2) {\r\n  return rect1.x < rect2.x + rect2.width &&\r\n         rect1.x + rect1.width > rect2.x &&\r\n         rect1.y < rect2.y + rect2.height &&\r\n         rect1.y + rect1.height > rect2.y;\r\n}\r\n\r\n/**\r\n * 计算线段的斜率\r\n */\r\nexport function getSlope(point1, point2) {\r\n  if (point2.x === point1.x) return Infinity; // 垂直线\r\n  return (point2.y - point1.y) / (point2.x - point1.x);\r\n}\r\n\r\n/**\r\n * 计算线段的垂直平分线\r\n */\r\nexport function getPerpendicularBisector(point1, point2) {\r\n  const midPoint = {\r\n    x: (point1.x + point2.x) / 2,\r\n    y: (point1.y + point2.y) / 2\r\n  };\r\n  \r\n  const slope = getSlope(point1, point2);\r\n  const perpendicularSlope = slope === 0 ? Infinity : slope === Infinity ? 0 : -1 / slope;\r\n  \r\n  return {\r\n    point: midPoint,\r\n    slope: perpendicularSlope\r\n  };\r\n}\r\n","/**\r\n * 通用工具函数\r\n */\r\n\r\n/**\r\n * 生成唯一ID\r\n */\r\nexport function generateId(prefix = '') {\r\n  return `${prefix}${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n}\r\n\r\n/**\r\n * 防抖函数\r\n */\r\nexport function debounce(func, wait, immediate = false) {\r\n  let timeout;\r\n  return function executedFunction(...args) {\r\n    const later = () => {\r\n      timeout = null;\r\n      if (!immediate) func(...args);\r\n    };\r\n    const callNow = immediate && !timeout;\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(later, wait);\r\n    if (callNow) func(...args);\r\n  };\r\n}\r\n\r\n/**\r\n * 节流函数\r\n */\r\nexport function throttle(func, limit) {\r\n  let inThrottle;\r\n  return function(...args) {\r\n    if (!inThrottle) {\r\n      func.apply(this, args);\r\n      inThrottle = true;\r\n      setTimeout(() => inThrottle = false, limit);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * 深拷贝对象\r\n */\r\nexport function deepClone(obj) {\r\n  if (obj === null || typeof obj !== 'object') return obj;\r\n  if (obj instanceof Date) return new Date(obj.getTime());\r\n  if (obj instanceof Array) return obj.map(item => deepClone(item));\r\n  if (obj instanceof Object) {\r\n    const clonedObj = {};\r\n    for (const key in obj) {\r\n      if (obj.hasOwnProperty(key)) {\r\n        clonedObj[key] = deepClone(obj[key]);\r\n      }\r\n    }\r\n    return clonedObj;\r\n  }\r\n}\r\n\r\n/**\r\n * 合并多个对象\r\n */\r\nexport function mergeObjects(...objects) {\r\n  return objects.reduce((result, obj) => {\r\n    if (obj && typeof obj === 'object') {\r\n      Object.keys(obj).forEach(key => {\r\n        if (obj[key] !== undefined) {\r\n          if (typeof obj[key] === 'object' && obj[key] !== null && \r\n              typeof result[key] === 'object' && result[key] !== null) {\r\n            result[key] = mergeObjects(result[key], obj[key]);\r\n          } else {\r\n            result[key] = deepClone(obj[key]);\r\n          }\r\n        }\r\n      });\r\n    }\r\n    return result;\r\n  }, {});\r\n}\r\n\r\n/**\r\n * 格式化文件大小\r\n */\r\nexport function formatFileSize(bytes) {\r\n  if (bytes === 0) return '0 Bytes';\r\n  const k = 1024;\r\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\r\n}\r\n\r\n/**\r\n * 颜色转换：RGB 转 HEX\r\n */\r\nexport function rgbToHex(r, g, b) {\r\n  return '#' + [r, g, b].map(x => {\r\n    const hex = x.toString(16);\r\n    return hex.length === 1 ? '0' + hex : hex;\r\n  }).join('');\r\n}\r\n\r\n/**\r\n * 颜色转换：HEX 转 RGB\r\n */\r\nexport function hexToRgb(hex) {\r\n  const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n  return result ? {\r\n    r: parseInt(result[1], 16),\r\n    g: parseInt(result[2], 16),\r\n    b: parseInt(result[3], 16)\r\n  } : null;\r\n}\r\n\r\n/**\r\n * 获取鼠标位置相对于元素的坐标\r\n */\r\nexport function getRelativeMousePosition(event, element) {\r\n  const rect = element.getBoundingClientRect();\r\n  return {\r\n    x: event.clientX - rect.left,\r\n    y: event.clientY - rect.top\r\n  };\r\n}\r\n\r\n/**\r\n * 限制数值在最小最大值之间\r\n */\r\nexport function clamp(value, min, max) {\r\n  return Math.min(Math.max(value, min), max);\r\n}\r\n\r\n/**\r\n * 线性插值\r\n */\r\nexport function lerp(start, end, factor) {\r\n  return start + (end - start) * factor;\r\n}\r\n\r\n/**\r\n * 判断点是否在矩形内\r\n */\r\nexport function isPointInRect(point, rect, tolerance = 0) {\r\n  return point.x >= rect.x - tolerance && \r\n         point.x <= rect.x + rect.width + tolerance && \r\n         point.y >= rect.y - tolerance && \r\n         point.y <= rect.y + rect.height + tolerance;\r\n}\r\n\r\n/**\r\n * 判断点是否在圆形内\r\n */\r\nexport function isPointInCircle(point, circle, tolerance = 0) {\r\n  const distance = Math.sqrt((point.x - circle.x) ** 2 + (point.y - circle.y) ** 2);\r\n  return distance <= circle.radius + tolerance;\r\n}\r\n","import { generateId } from '../utils/index';\r\nexport default class BaseTool {\r\n  constructor(drawer) {\r\n    this.drawer = drawer;\r\n    this.name = 'base';\r\n    this.isDrawing = false;\r\n    this.currentShape = null;\r\n  }\r\n\r\n  activate() {\r\n    this._bindEvents();\r\n  }\r\n\r\n  deactivate() {\r\n    this._unbindEvents();\r\n  }\r\n\r\n  _bindEvents() {\r\n    this.drawer.on('mousedown', this._onMouseDown.bind(this));\r\n    this.drawer.on('mousemove', this._onMouseMove.bind(this));\r\n    this.drawer.on('mouseup', this._onMouseUp.bind(this));\r\n    this.drawer.on('dblclick', this._onDoubleClick.bind(this));\r\n  }\r\n\r\n  _unbindEvents() {\r\n    // 在具体工具类中实现\r\n  }\r\n\r\n  _onMouseDown({ point, event }) {}\r\n  _onMouseMove({ point, event }) {}\r\n  _onMouseUp({ point, event }) {}\r\n  _onDoubleClick({ point, event }) {}\r\n\r\n  _createShape(type, data) {\r\n    return {\r\n      id: generateId(type),\r\n      type,\r\n      data: {\r\n        ...data,\r\n        color: this.drawer.currentColor,\r\n        lineWidth: this.drawer.currentLineWidth,\r\n        createdAt: new Date().toISOString()\r\n      }\r\n    };\r\n  }\r\n}\r\n","import BaseTool from './base-tool.js';\r\n\r\nexport default class BrushTool extends BaseTool {\r\n  constructor(drawer) {\r\n    super(drawer);\r\n    this.name = 'brush';\r\n    this.points = [];\r\n  }\r\n\r\n  _onMouseDown({ point, event }) {\r\n    this.isDrawing = true;\r\n    this.points = [point];\r\n    \r\n    this.currentShape = this._createShape('brush', {\r\n      points: [point],\r\n      isComplete: false\r\n    });\r\n\r\n    // 开始绘制路径\r\n    this.drawer.ctx.beginPath();\r\n    this.drawer.ctx.moveTo(point.x, point.y);\r\n  }\r\n\r\n  _onMouseMove({ point, event }) {\r\n    if (!this.isDrawing) return;\r\n\r\n    this.points.push(point);\r\n    this.currentShape.data.points = this.points;\r\n\r\n    // 绘制实时路径\r\n    this.drawer.ctx.lineTo(point.x, point.y);\r\n    this.drawer.ctx.stroke();\r\n  }\r\n\r\n  _onMouseUp({ point, event }) {\r\n    if (!this.isDrawing) return;\r\n\r\n    this.isDrawing = false;\r\n    this.currentShape.data.isComplete = true;\r\n    this.currentShape.data.points = [...this.points];\r\n    \r\n    // 添加最终图形\r\n    if (this.points.length > 1) {\r\n      this.drawer.addShape(this.currentShape);\r\n    }\r\n    \r\n    this.points = [];\r\n    this.currentShape = null;\r\n  }\r\n\r\n  _unbindEvents() {\r\n    this.isDrawing = false;\r\n    this.points = [];\r\n    this.currentShape = null;\r\n    this.drawer.resetEvent();\r\n  }\r\n}\r\n","import BaseTool from './base-tool.js';\r\nimport { isPointInRect } from '../utils/index';\r\n\r\nexport default class RectangleTool extends BaseTool {\r\n  constructor(drawer) {\r\n    super(drawer);\r\n    this.name = 'rectangle';\r\n    this.startPoint = null;\r\n  }\r\n\r\n  _onMouseDown({ point, event }) {\r\n    this.isDrawing = true;\r\n    this.startPoint = point;\r\n    \r\n    this.currentShape = this._createShape('rectangle', {\r\n      x: point.x,\r\n      y: point.y,\r\n      width: 0,\r\n      height: 0\r\n    });\r\n  }\r\n\r\n  _onMouseMove({ point, event }) {\r\n    if (!this.isDrawing) return;\r\n\r\n    const width = point.x - this.startPoint.x;\r\n    const height = point.y - this.startPoint.y;\r\n\r\n    // 更新当前形状数据\r\n    this.currentShape.data.width = width;\r\n    this.currentShape.data.height = height;\r\n\r\n    // 重绘画布（包括预览）\r\n    this._drawPreview();\r\n  }\r\n\r\n  _onMouseUp({ point, event }) {\r\n    if (!this.isDrawing) return;\r\n\r\n    this.isDrawing = false;\r\n    \r\n    // 添加最终图形\r\n    if (Math.abs(this.currentShape.data.width) > 2 && \r\n        Math.abs(this.currentShape.data.height) > 2) {\r\n      this.drawer.addShape(this.currentShape);\r\n    }\r\n    \r\n    this.currentShape = null;\r\n    this.startPoint = null;\r\n  }\r\n\r\n  _drawPreview() {\r\n    // 清空画布并重绘所有图形\r\n    this.drawer.ctx.clearRect(0, 0, this.drawer.canvas.width, this.drawer.canvas.height);\r\n    \r\n    // 绘制已保存的图形\r\n    this.drawer.getShapes().forEach(shape => {\r\n      shape.draw(this.drawer.ctx);\r\n    });\r\n    \r\n    // 绘制预览矩形（虚线）\r\n    this.drawer.ctx.save();\r\n    this.drawer.ctx.strokeStyle = this.currentShape.data.color;\r\n    this.drawer.ctx.lineWidth = this.currentShape.data.lineWidth;\r\n    this.drawer.ctx.setLineDash([5, 5]);\r\n    \r\n    this.drawer.ctx.strokeRect(\r\n      this.currentShape.data.x,\r\n      this.currentShape.data.y,\r\n      this.currentShape.data.width,\r\n      this.currentShape.data.height\r\n    );\r\n    \r\n    this.drawer.ctx.restore();\r\n  }\r\n\r\n  _unbindEvents() {\r\n    this.isDrawing = false;\r\n    this.currentShape = null;\r\n    this.startPoint = null;\r\n    this.drawer.resetEvent();\r\n  }\r\n\r\n  containsPoint(point, tolerance = 5) {\r\n    return isPointInRect(point, this.data, tolerance);\r\n  }\r\n}\r\n","import BaseTool from './base-tool.js';\r\nimport { isPointInCircle } from '../utils/index';;\r\n\r\nexport default class CircleTool extends BaseTool {\r\n  constructor(drawer) {\r\n    super(drawer);\r\n    this.name = 'circle';\r\n    this.centerPoint = null;\r\n    this.radius = 0;\r\n  }\r\n\r\n  _onMouseDown({ point, event }) {\r\n    this.isDrawing = true;\r\n    this.centerPoint = point;\r\n    this.radius = 0;\r\n\r\n    this.currentShape = this._createShape('circle', {\r\n      x: point.x,\r\n      y: point.y,\r\n      radius: 0\r\n    });\r\n  }\r\n\r\n  _onMouseMove({ point, event }) {\r\n    if (!this.isDrawing) return;\r\n\r\n    const dx = point.x - this.centerPoint.x;\r\n    const dy = point.y - this.centerPoint.y;\r\n    this.radius = Math.sqrt(dx * dx + dy * dy);\r\n\r\n    this.currentShape.data.radius = this.radius;\r\n\r\n    this._drawPreview();\r\n  }\r\n\r\n  _onMouseUp({ point, event }) {\r\n    if (!this.isDrawing) return;\r\n\r\n    this.isDrawing = false;\r\n    \r\n    // 添加最终图形（半径大于2像素才保存）\r\n    if (this.radius > 2) {\r\n      this.drawer.addShape(this.currentShape);\r\n    }\r\n    \r\n    this.centerPoint = null;\r\n    this.radius = 0;\r\n    this.currentShape = null;\r\n  }\r\n\r\n  _drawPreview() {\r\n    // 清空画布并重绘所有图形\r\n    this.drawer.ctx.clearRect(0, 0, this.drawer.canvas.width, this.drawer.canvas.height);\r\n    \r\n    // 绘制已保存的图形\r\n    this.drawer.getShapes().forEach(shape => {\r\n      shape.draw(this.drawer.ctx);\r\n    });\r\n    \r\n    // 绘制预览圆形（虚线）\r\n    this.drawer.ctx.save();\r\n    this.drawer.ctx.strokeStyle = this.currentShape.data.color;\r\n    this.drawer.ctx.lineWidth = this.currentShape.data.lineWidth;\r\n    this.drawer.ctx.setLineDash([5, 5]);\r\n    \r\n    this.drawer.ctx.beginPath();\r\n    this.drawer.ctx.arc(\r\n      this.centerPoint.x,\r\n      this.centerPoint.y,\r\n      this.radius,\r\n      0,\r\n      Math.PI * 2\r\n    );\r\n    this.drawer.ctx.stroke();\r\n    \r\n    this.drawer.ctx.restore();\r\n  }\r\n\r\n  _unbindEvents() {\r\n    this.isDrawing = false;\r\n    this.centerPoint = null;\r\n    this.radius = 0;\r\n    this.currentShape = null;\r\n    this.drawer.resetEvent();\r\n  }\r\n\r\n  containsPoint(point, tolerance = 5) {\r\n    return isPointInCircle(point, this.data, tolerance);\r\n  }\r\n}\r\n","import BaseTool from './base-tool.js';\r\nimport { isPointInPolygon } from '../utils/index';;\r\n\r\nexport default class PolygonTool extends BaseTool {\r\n  constructor(drawer) {\r\n    super(drawer);\r\n    this.name = 'polygon';\r\n    this.points = [];\r\n    this.isComplete = false;\r\n  }\r\n\r\n  _onMouseDown({ point, event }) {\r\n    if (this.isComplete) return;\r\n\r\n    if (!this.isDrawing) {\r\n      // 开始绘制多边形\r\n      this.isDrawing = true;\r\n      this.points = [point];\r\n      \r\n      this.currentShape = this._createShape('polygon', {\r\n        points: [point],\r\n        isComplete: false\r\n      });\r\n    } else {\r\n      // 添加新顶点\r\n      this.points.push(point);\r\n      this.currentShape.data.points = this.points;\r\n      \r\n      this._drawPreview();\r\n    }\r\n  }\r\n\r\n  _onMouseMove({ point, event }) {\r\n    if (!this.isDrawing || this.isComplete) return;\r\n\r\n    this._drawPreview(point);\r\n  }\r\n\r\n  _onDoubleClick({ point, event }) {\r\n    if (this.isDrawing && !this.isComplete && this.points.length >= 2) {\r\n      this._completePolygon();\r\n    }\r\n  }\r\n\r\n  _completePolygon() {\r\n    this.isComplete = true;\r\n    this.currentShape.data.isComplete = true;\r\n    this.currentShape.data.points = [...this.points];\r\n    \r\n    // 添加最终图形（至少3个点才构成多边形）\r\n    if (this.points.length >= 3) {\r\n      this.drawer.addShape(this.currentShape);\r\n    }\r\n    \r\n    this._reset();\r\n  }\r\n\r\n  _drawPreview(currentPoint = null) {\r\n    // 清空画布并重绘所有图形\r\n    this.drawer.ctx.clearRect(0, 0, this.drawer.canvas.width, this.drawer.canvas.height);\r\n    \r\n    // 绘制已保存的图形\r\n    this.drawer.getShapes().forEach(shape => {\r\n      shape.draw(this.drawer.ctx);\r\n    });\r\n    \r\n    if (this.points.length === 0) return;\r\n\r\n    // 绘制预览多边形\r\n    this.drawer.ctx.save();\r\n    this.drawer.ctx.strokeStyle = this.currentShape.data.color;\r\n    this.drawer.ctx.lineWidth = this.currentShape.data.lineWidth;\r\n    this.drawer.ctx.setLineDash([5, 5]);\r\n    \r\n    this.drawer.ctx.beginPath();\r\n    this.drawer.ctx.moveTo(this.points[0].x, this.points[0].y);\r\n    \r\n    // 绘制已确定的边\r\n    for (let i = 1; i < this.points.length; i++) {\r\n      this.drawer.ctx.lineTo(this.points[i].x, this.points[i].y);\r\n    }\r\n    \r\n    // 绘制当前预览边\r\n    if (currentPoint && this.points.length > 0) {\r\n      const lastPoint = this.points[this.points.length - 1];\r\n      this.drawer.ctx.lineTo(currentPoint.x, currentPoint.y);\r\n      \r\n      // 绘制闭合预览线\r\n      // this.drawer.ctx.moveTo(currentPoint.x, currentPoint.y);\r\n    }\r\n\r\n    this.drawer.ctx.lineTo(this.points[0].x, this.points[0].y);\r\n    this.drawer.ctx.stroke();\r\n    this.drawer.ctx.restore();\r\n  }\r\n\r\n  _reset() {\r\n    this.isDrawing = false;\r\n    this.isComplete = false;\r\n    this.points = [];\r\n    this.currentShape = null;\r\n    this.drawer.resetEvent();\r\n  }\r\n\r\n  _unbindEvents() {\r\n    this._reset();\r\n  }\r\n\r\n  containsPoint(point, tolerance = 5) {\r\n    return isPointInPolygon(point, this.data.points);\r\n  }\r\n}\r\n","import BaseTool from './base-tool.js';\r\nimport { \r\n  isPointInRect, \r\n  isPointInCircle, \r\n  isPointInPolygon,\r\n  pointToLineDistance \r\n} from '../utils/index';\r\n\r\nexport default class SelectTool extends BaseTool {\r\n  constructor(drawer) {\r\n    super(drawer);\r\n    this.name = 'select';\r\n    this.selectedShape = null;\r\n    this.isDragging = false;\r\n    this.dragStartPoint = null;\r\n    this.originalShapePosition = null;\r\n  }\r\n\r\n  _onMouseDown({ point, event }) {\r\n    // 检查是否点击了图形\r\n    const clickedShape = this._findShapeAtPoint(point);\r\n    \r\n    if (clickedShape) {\r\n      this.selectedShape = clickedShape;\r\n      this.isDragging = true;\r\n      this.dragStartPoint = point;\r\n      this.originalShapePosition = this._getShapePosition(clickedShape);\r\n      \r\n      // 触发选中事件\r\n      this.drawer.eventManager.emit('shapeSelected', { \r\n        shape: clickedShape, \r\n        point \r\n      });\r\n      \r\n      this._drawSelectionHighlight();\r\n    } else {\r\n      this._clearSelection();\r\n    }\r\n  }\r\n\r\n  _onMouseMove({ point, event }) {\r\n    if (!this.isDragging || !this.selectedShape) return;\r\n\r\n    const dx = point.x - this.dragStartPoint.x;\r\n    const dy = point.y - this.dragStartPoint.y;\r\n    \r\n    this._moveShape(this.selectedShape, dx, dy);\r\n    this.dragStartPoint = point;\r\n    \r\n    this._redrawCanvas();\r\n    this._drawSelectionHighlight();\r\n  }\r\n\r\n  _onMouseUp({ point, event }) {\r\n    if (this.isDragging && this.selectedShape) {\r\n      this.drawer.eventManager.emit('shapeMoved', { \r\n        shape: this.selectedShape, \r\n        from: this.originalShapePosition, \r\n        to: this._getShapePosition(this.selectedShape) \r\n      });\r\n    }\r\n    \r\n    this.isDragging = false;\r\n    this.dragStartPoint = null;\r\n    this.originalShapePosition = null;\r\n  }\r\n\r\n  _findShapeAtPoint(point, tolerance = 5) {\r\n    const shapes = this.drawer.getShapes();\r\n    \r\n    // 从后往前检查（最后绘制的在最上面）\r\n    for (let i = shapes.length - 1; i >= 0; i--) {\r\n      const shape = shapes[i];\r\n      if (this._isPointInShape(point, shape, tolerance)) {\r\n        return shape;\r\n      }\r\n    }\r\n    \r\n    return null;\r\n  }\r\n\r\n  _isPointInShape(point, shape, tolerance) {\r\n    switch (shape.type) {\r\n      case 'rectangle':\r\n        return isPointInRect(point, shape.data, tolerance);\r\n      case 'circle':\r\n        return isPointInCircle(point, shape.data, tolerance);\r\n      case 'polygon':\r\n        return isPointInPolygon(point, shape.data.points);\r\n      case 'brush':\r\n        return this._isPointInBrush(point, shape.data, tolerance);\r\n      default:\r\n        return false;\r\n    }\r\n  }\r\n\r\n  _isPointInBrush(point, brushData, tolerance) {\r\n    const { points, lineWidth } = brushData;\r\n    if (points.length < 2) return false;\r\n\r\n    for (let i = 1; i < points.length; i++) {\r\n      const prev = points[i - 1];\r\n      const curr = points[i];\r\n      \r\n      const distance = pointToLineDistance(point, prev, curr);\r\n      if (distance <= lineWidth / 2 + tolerance) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  _moveShape(shape, dx, dy) {\r\n    switch (shape.type) {\r\n      case 'rectangle':\r\n        shape.data.x += dx;\r\n        shape.data.y += dy;\r\n        break;\r\n      case 'circle':\r\n        shape.data.x += dx;\r\n        shape.data.y += dy;\r\n        break;\r\n      case 'polygon':\r\n        shape.data.points.forEach(point => {\r\n          point.x += dx;\r\n          point.y += dy;\r\n        });\r\n        break;\r\n      case 'brush':\r\n        shape.data.points.forEach(point => {\r\n          point.x += dx;\r\n          point.y += dy;\r\n        });\r\n        break;\r\n    }\r\n  }\r\n\r\n  _getShapePosition(shape) {\r\n    switch (shape.type) {\r\n      case 'rectangle':\r\n        return { x: shape.data.x, y: shape.data.y };\r\n      case 'circle':\r\n        return { x: shape.data.x, y: shape.data.y };\r\n      case 'polygon':\r\n        // 返回多边形的中心点（近似）\r\n        const points = shape.data.points;\r\n        const centerX = points.reduce((sum, p) => sum + p.x, 0) / points.length;\r\n        const centerY = points.reduce((sum, p) => sum + p.y, 0) / points.length;\r\n        return { x: centerX, y: centerY };\r\n      case 'brush':\r\n        // 返回笔划的起点\r\n        const firstPoint = shape.data.points[0];\r\n        return { x: firstPoint.x, y: firstPoint.y };\r\n      default:\r\n        return { x: 0, y: 0 };\r\n    }\r\n  }\r\n\r\n  _drawSelectionHighlight() {\r\n    if (!this.selectedShape) return;\r\n\r\n    this.drawer.ctx.save();\r\n    this.drawer.ctx.strokeStyle = '#007bff';\r\n    this.drawer.ctx.lineWidth = 2;\r\n    this.drawer.ctx.setLineDash([5, 5]);\r\n    \r\n    switch (this.selectedShape.type) {\r\n      case 'rectangle':\r\n        const rect = this.selectedShape.data;\r\n        this.drawer.ctx.strokeRect(\r\n          rect.x - 3, \r\n          rect.y - 3, \r\n          rect.width + 6, \r\n          rect.height + 6\r\n        );\r\n        break;\r\n      case 'circle':\r\n        const circle = this.selectedShape.data;\r\n        this.drawer.ctx.beginPath();\r\n        this.drawer.ctx.arc(\r\n          circle.x, \r\n          circle.y, \r\n          circle.radius + 3, \r\n          0, \r\n          Math.PI * 2\r\n        );\r\n        this.drawer.ctx.stroke();\r\n        break;\r\n      case 'polygon':\r\n        const polygon = this.selectedShape.data;\r\n        if (polygon.points.length >= 3) {\r\n          this.drawer.ctx.beginPath();\r\n          this.drawer.ctx.moveTo(polygon.points[0].x, polygon.points[0].y);\r\n          for (let i = 1; i < polygon.points.length; i++) {\r\n            this.drawer.ctx.lineTo(polygon.points[i].x, polygon.points[i].y);\r\n          }\r\n          this.drawer.ctx.closePath();\r\n          this.drawer.ctx.stroke();\r\n        }\r\n        break;\r\n    }\r\n    \r\n    this.drawer.ctx.restore();\r\n  }\r\n\r\n  _clearSelection() {\r\n    if (this.selectedShape) {\r\n      this.drawer.eventManager.emit('shapeDeselected', { \r\n        shape: this.selectedShape \r\n      });\r\n    }\r\n    \r\n    this.selectedShape = null;\r\n    this._redrawCanvas();\r\n  }\r\n\r\n  _redrawCanvas() {\r\n    this.drawer.ctx.clearRect(0, 0, this.drawer.canvas.width, this.drawer.canvas.height);\r\n    this.drawer.getShapes().forEach(shape => {\r\n      shape.draw(this.drawer.ctx);\r\n    });\r\n  }\r\n\r\n  _unbindEvents() {\r\n    this._clearSelection();\r\n    this.isDragging = false;\r\n    this.dragStartPoint = null;\r\n    this.originalShapePosition = null;\r\n    this.drawer.resetEvent();\r\n  }\r\n}\r\n","import CanvasDrawer from \"./core/canvas-drawer.js\";\r\nimport {\r\n  BrushTool,\r\n  RectangleTool,\r\n  CircleTool,\r\n  PolygonTool,\r\n  SelectTool,\r\n} from \"./tools/index.js\";\r\n\r\n// 工具类型常量\r\nexport const ToolType = {\r\n  BRUSH: \"brush\",\r\n  RECTANGLE: \"rectangle\",\r\n  CIRCLE: \"circle\",\r\n  POLYGON: \"polygon\",\r\n  SELECT: \"select\",\r\n};\r\n\r\n// 默认配置\r\nexport const DefaultConfig = {\r\n  width: 800,\r\n  height: 600,\r\n  backgroundColor: \"#ffffff\",\r\n  defaultColor: \"#000000\",\r\n  defaultLineWidth: 2,\r\n};\r\n\r\n/**\r\n * Canvas 绘图工具库\r\n */\r\nclass CanvasDrawingTool {\r\n  constructor(container, config = {}) {\r\n    this.config = { ...DefaultConfig, ...config };\r\n    this.container =\r\n      typeof container === \"string\"\r\n        ? document.querySelector(container)\r\n        : container;\r\n    if (!this.container) {\r\n      throw new Error(`Container with \"${container}\" not found`);\r\n    }\r\n\r\n    this.drawer = new CanvasDrawer(this.container, this.config);\r\n    this.currentTool = null;\r\n    this.tools = new Map();\r\n\r\n    this._initializeTools();\r\n  }\r\n\r\n  _initializeTools() {\r\n    // 注册默认工具\r\n    this.registerTool(ToolType.BRUSH, new BrushTool(this.drawer));\r\n    this.registerTool(ToolType.RECTANGLE, new RectangleTool(this.drawer));\r\n    this.registerTool(ToolType.CIRCLE, new CircleTool(this.drawer));\r\n    this.registerTool(ToolType.POLYGON, new PolygonTool(this.drawer));\r\n    this.registerTool(ToolType.SELECT, new SelectTool(this.drawer));\r\n\r\n    // 默认使用画笔工具\r\n    this.setTool(ToolType.BRUSH);\r\n  }\r\n\r\n  /**\r\n   * 注册工具\r\n   */\r\n  registerTool(name, tool) {\r\n    this.tools.set(name, tool);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * 设置当前工具\r\n   */\r\n  setTool(toolName) {\r\n    if (this.currentTool) {\r\n      this.currentTool.deactivate();\r\n    }\r\n\r\n    const tool = this.tools.get(toolName);\r\n    if (tool) {\r\n      this.currentTool = tool;\r\n      this.currentTool.activate();\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * 设置画笔颜色\r\n   */\r\n  setColor(color) {\r\n    this.drawer.setColor(color);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * 设置画笔宽度\r\n   */\r\n  setLineWidth(width) {\r\n    this.drawer.setLineWidth(width);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * 清空画布\r\n   */\r\n  clear() {\r\n    this.drawer.clear();\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * 获取所有图形\r\n   */\r\n  getShapes() {\r\n    return this.drawer.getShapes();\r\n  }\r\n\r\n  /**\r\n   * 添加图形\r\n   */\r\n  addShape(shapeData) {\r\n    this.drawer.addShape(shapeData);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * 删除图形\r\n   */\r\n  removeShape(shapeId) {\r\n    this.drawer.removeShape(shapeId);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * 导出为图片\r\n   */\r\n  exportImage(format = \"image/png\", quality = 1.0) {\r\n    return this.drawer.exportImage(format, quality);\r\n  }\r\n\r\n  /**\r\n   * 导入图形数据\r\n   */\r\n  importData(shapesData) {\r\n    this.drawer.importData(shapesData);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * 导出图形数据\r\n   */\r\n  exportData() {\r\n    return this.drawer.exportData();\r\n  }\r\n\r\n  /**\r\n   * 销毁实例\r\n   */\r\n  destroy() {\r\n    this.drawer.destroy();\r\n    this.tools.clear();\r\n    this.currentTool = null;\r\n  }\r\n\r\n  /**\r\n   * 事件监听\r\n   */\r\n  on(event, callback) {\r\n    this.drawer.on(event, callback);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * 移除事件监听\r\n   */\r\n  off(event, callback) {\r\n    this.drawer.off(event, callback);\r\n    return this;\r\n  }\r\n}\r\n\r\n// 导出主要类和工具\r\nexport { CanvasDrawer };\r\nexport { BrushTool, RectangleTool, CircleTool, PolygonTool, SelectTool };\r\n\r\nexport default CanvasDrawingTool;\r\n"],"names":["EventManager","constructor","this","events","Map","on","event","callback","has","set","Set","get","add","off","delete","emit","data","forEach","error","console","clear","Shape","id","type","draw","ctx","containsPoint","point","toJSON","fromJSON","json","Rectangle","super","save","strokeStyle","color","lineWidth","strokeRect","x","y","width","height","restore","tolerance","Circle","beginPath","arc","radius","Math","PI","stroke","sqrt","Polygon","points","length","moveTo","i","lineTo","closePath","inside","j","xi","yi","xj","yj","Brush","prev","curr","_pointToLineDistance","lineStart","lineEnd","A","B","C","D","lenSq","xx","yy","param","dx","dy","ShapeFactory","createShape","shapeData","warn","createShapeFromJSON","CanvasDrawer","container","config","canvas","shapes","eventManager","isDrawing","_initializeCanvas","_bindEvents","document","createElement","style","backgroundColor","cursor","appendChild","getContext","currentColor","defaultColor","currentLineWidth","defaultLineWidth","addEventListener","_handleMouseDown","bind","_handleMouseMove","_handleMouseUp","_handleDoubleClick","_getMousePosition","rect","getBoundingClientRect","clientX","left","clientY","top","setColor","setLineWidth","clearRect","addShape","shape","_redraw","removeShape","shapeId","getShapes","Array","from","values","getShape","exportImage","format","quality","toDataURL","importData","shapesData","exportData","map","resetEvent","destroy","remove","setSize","currentImage","getDataUrl","img","Image","onload","fillStyle","fillRect","drawImage","src","setBackgroundColor","pointToLineDistance","isPointInPolygon","polygonPoints","generateId","prefix","Date","now","random","toString","substr","isPointInRect","isPointInCircle","circle","BaseTool","drawer","name","currentShape","activate","deactivate","_unbindEvents","_onMouseDown","_onMouseMove","_onMouseUp","_onDoubleClick","_createShape","createdAt","toISOString","BrushTool","isComplete","push","RectangleTool","startPoint","_drawPreview","abs","setLineDash","CircleTool","centerPoint","PolygonTool","_completePolygon","_reset","currentPoint","SelectTool","selectedShape","isDragging","dragStartPoint","originalShapePosition","clickedShape","_findShapeAtPoint","_getShapePosition","_drawSelectionHighlight","_clearSelection","_moveShape","_redrawCanvas","to","_isPointInShape","_isPointInBrush","brushData","reduce","sum","p","firstPoint","polygon","ToolType","BRUSH","RECTANGLE","CIRCLE","POLYGON","SELECT","DefaultConfig","querySelector","Error","currentTool","tools","_initializeTools","registerTool","setTool","tool","toolName"],"mappings":"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"}