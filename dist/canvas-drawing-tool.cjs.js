"use strict";const t=(t,s)=>{const n=t.getBoundingClientRect();let e,a;return s.type.includes("touch")?(e=s.touches[0].clientX,a=s.touches[0].clientY):(e=s.clientX,a=s.clientY),{x:e-n.left,y:a-n.top}};class s{constructor(t,s){this.canvas=t,this.drawingBoard=s,this.isDrawing=!1,this.lastX=0,this.lastY=0,this.bindEvents()}bindEvents(){this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mouseout",this.handleMouseUp.bind(this)),this.canvas.addEventListener("touchstart",this.handleTouchStart.bind(this)),this.canvas.addEventListener("touchmove",this.handleTouchMove.bind(this)),this.canvas.addEventListener("touchend",this.handleTouchEnd.bind(this)),this.canvas.addEventListener("touchstart",this.preventDefaultTouch),this.canvas.addEventListener("touchmove",this.preventDefaultTouch)}handleMouseDown(t){this.startDrawing(t)}handleMouseMove(t){this.draw(t)}handleMouseUp(){this.stopDrawing()}handleTouchStart(t){this.startDrawing(t)}handleTouchMove(t){this.draw(t)}handleTouchEnd(){this.stopDrawing()}startDrawing(s){this.isDrawing=!0;const n=t(this.canvas,s);[this.lastX,this.lastY]=[n.x,n.y],this.drawingBoard.onStartDrawing&&this.drawingBoard.onStartDrawing(n.x,n.y)}draw(s){if(!this.isDrawing)return;s.preventDefault();const n=t(this.canvas,s);this.drawingBoard.drawLine(this.lastX,this.lastY,n.x,n.y),[this.lastX,this.lastY]=[n.x,n.y],this.drawingBoard.onDrawing&&this.drawingBoard.onDrawing(n.x,n.y)}stopDrawing(){this.isDrawing=!1,this.drawingBoard.onStopDrawing&&this.drawingBoard.onStopDrawing()}preventDefaultTouch(t){t.preventDefault()}destroy(){this.canvas.replaceWith(this.canvas.cloneNode(!0))}}class n{constructor(t,s){this.drawingBoard=t,this.container=s,this.currentTool="brush",this.toolElements=new Map,this.initTools(),this.createToolbar(),this.bindToolEvents()}initTools(){this.tools={brush:{name:"画笔",color:"#e74c3c",size:5,cursor:"crosshair"},eraser:{name:"橡皮擦",color:"white",size:20,cursor:"crosshair"}}}createToolbar(){const t=document.createElement("div");t.className="canvas-drawing-toolbar",t.innerHTML='\n            <button class="canvas-tool-btn active" data-tool="brush">画笔</button>\n            <button class="canvas-tool-btn" data-tool="eraser">橡皮擦</button>\n            <input type="color" class="canvas-color-picker" value="#e74c3c">\n            <div class="canvas-brush-size">\n                <span>粗细:</span>\n                <input type="range" class="canvas-size-slider" min="1" max="50" value="5">\n                <span class="canvas-size-value">5px</span>\n            </div>\n            <button class="canvas-tool-btn" id="canvas-clear-btn">清空</button>\n            <button class="canvas-tool-btn" id="canvas-save-btn">保存</button>\n        ',this.container.insertBefore(t,this.container.firstChild),this.toolElements.set("brush",t.querySelector('[data-tool="brush"]')),this.toolElements.set("eraser",t.querySelector('[data-tool="eraser"]')),this.colorPicker=t.querySelector(".canvas-color-picker"),this.sizeSlider=t.querySelector(".canvas-size-slider"),this.sizeValue=t.querySelector(".canvas-size-value")}bindToolEvents(){this.toolElements.forEach((t,s)=>{t.addEventListener("click",()=>{this.setCurrentTool(s)})}),this.colorPicker.addEventListener("input",t=>{this.tools.brush.color=t.target.value,"brush"===this.currentTool&&this.drawingBoard.setTool(this.tools.brush)}),this.sizeSlider.addEventListener("input",t=>{const s=parseInt(t.target.value);this.tools.brush.size=s,this.sizeValue.textContent=s+"px","brush"===this.currentTool&&this.drawingBoard.setTool(this.tools.brush)}),this.container.querySelector("#canvas-clear-btn").addEventListener("click",()=>{this.drawingBoard.clearCanvas()}),this.container.querySelector("#canvas-save-btn").addEventListener("click",()=>{this.drawingBoard.saveImage()})}setCurrentTool(t){this.tools[t]&&(this.currentTool=t,this.toolElements.forEach((s,n)=>{s.classList.toggle("active",n===t)}),this.drawingBoard.setTool(this.tools[t]))}getCurrentTool(){return this.tools[this.currentTool]}destroy(){const t=this.container.querySelector(".canvas-drawing-toolbar");t&&t.remove()}}class e{constructor(t,s={}){if(this.container="string"==typeof t?document.getElementById(t):t,!this.container)throw new Error(`Container with id "${t}" not found`);this.options={width:s.width||800,height:s.height||500,backgroundColor:s.backgroundColor||"#ffffff",showToolbar:!1!==s.showToolbar,...s},this.currentTool=null,this.isDestroyed=!1,this.init()}init(){this.createCanvas(),this.initCanvas(),this.options.showToolbar&&(this.toolManager=new n(this,this.container)),this.eventHandler=new s(this.canvas,this),this.bindKeyboardEvents()}createCanvas(){this.canvas=document.createElement("canvas"),this.canvas.width=this.options.width,this.canvas.height=this.options.height,this.canvas.className="canvas-drawing-canvas",this.canvas.style.cursor="crosshair",this.container.innerHTML="",this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d")}initCanvas(){this.ctx.fillStyle=this.options.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.lineJoin="round",this.ctx.lineCap="round",this.setTool({color:"#e74c3c",size:5})}setTool(t){this.currentTool=t}drawLine(t,s,n,e){this.isDestroyed||(this.ctx.beginPath(),this.ctx.moveTo(t,s),this.ctx.lineTo(n,e),this.ctx.strokeStyle=this.currentTool.color,this.ctx.lineWidth=this.currentTool.size,this.ctx.stroke())}clearCanvas(){this.isDestroyed||(this.ctx.fillStyle=this.options.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height))}saveImage(t=`drawing-${(new Date).getTime()}.png`){if(this.isDestroyed)return;((t,s)=>{const n=document.createElement("a");n.download=s,n.href=t,n.click()})(this.canvas.toDataURL("image/png"),t)}getDataUrl(t="image/png",s=1){return this.isDestroyed?"":this.canvas.toDataURL(t,s)}setSize(t,s){if(this.isDestroyed)return;const n=this.getDataUrl();this.canvas.width=t,this.canvas.height=s;const e=new Image;e.onload=()=>{this.ctx.fillStyle=this.options.backgroundColor,this.ctx.fillRect(0,0,t,s),this.ctx.drawImage(e,0,0)},e.src=n}setBackgroundColor(t){if(this.isDestroyed)return;this.options.backgroundColor=t;const s=this.getDataUrl();this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const n=new Image;n.onload=()=>{this.ctx.drawImage(n,0,0)},n.src=s}bindKeyboardEvents(){this.keyboardHandler=t=>{this.isDestroyed||(this.toolManager&&("b"!==t.key&&"B"!==t.key||(t.preventDefault(),this.toolManager.setCurrentTool("brush")),"e"!==t.key&&"E"!==t.key||(t.preventDefault(),this.toolManager.setCurrentTool("eraser"))),"Delete"===t.key&&(t.preventDefault(),this.clearCanvas()))},document.addEventListener("keydown",this.keyboardHandler)}onStartDrawing(t,s){}onDrawing(t,s){}onStopDrawing(){}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.eventHandler&&this.eventHandler.destroy(),this.toolManager&&this.toolManager.destroy(),this.keyboardHandler&&document.removeEventListener("keydown",this.keyboardHandler),this.container.innerHTML="")}}exports.DrawingBoard=e,exports.createDrawingBoard=function(t,s={}){return function(){if(document.querySelector("#canvas-drawing-tool-styles"))return;const t=document.createElement("style");t.id="canvas-drawing-tool-styles",t.textContent="\n.canvas-drawing-toolbar {\n    background: #2c3e50;\n    padding: 15px;\n    display: flex;\n    align-items: center;\n    gap: 15px;\n    flex-wrap: wrap;\n    border-bottom: 1px solid #34495e;\n}\n\n.canvas-tool-btn {\n    background: #34495e;\n    border: none;\n    color: white;\n    padding: 8px 15px;\n    border-radius: 5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    font-family: inherit;\n    font-size: 14px;\n}\n\n.canvas-tool-btn:hover {\n    background: #4a6572;\n    transform: translateY(-2px);\n}\n\n.canvas-tool-btn.active {\n    background: #e74c3c;\n    box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);\n}\n\n.canvas-color-picker {\n    width: 40px;\n    height: 40px;\n    border: none;\n    border-radius: 5px;\n    cursor: pointer;\n    padding: 0;\n}\n\n.canvas-brush-size {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    color: white;\n    font-size: 14px;\n}\n\n.canvas-size-slider {\n    width: 100px;\n}\n\n.canvas-drawing-canvas {\n    background: white;\n    border-radius: 0 0 8px 8px;\n    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);\n    cursor: crosshair;\n    display: block;\n}\n",document.head.appendChild(t)}(),new e(t,s)};
//# sourceMappingURL=canvas-drawing-tool.cjs.js.map
