!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).CanvasDrawingTool={})}(this,function(t){"use strict";const n=(t,n)=>{const s=t.getBoundingClientRect();let e,i;return n.type.includes("touch")?(e=n.touches[0].clientX,i=n.touches[0].clientY):(e=n.clientX,i=n.clientY),{x:e-s.left,y:i-s.top}};class s{constructor(t,n){this.canvas=t,this.drawingBoard=n,this.isDrawing=!1,this.lastX=0,this.lastY=0,this.bindEvents()}bindEvents(){this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mouseout",this.handleMouseUp.bind(this)),this.canvas.addEventListener("touchstart",this.handleTouchStart.bind(this)),this.canvas.addEventListener("touchmove",this.handleTouchMove.bind(this)),this.canvas.addEventListener("touchend",this.handleTouchEnd.bind(this)),this.canvas.addEventListener("touchstart",this.preventDefaultTouch),this.canvas.addEventListener("touchmove",this.preventDefaultTouch)}handleMouseDown(t){this.startDrawing(t)}handleMouseMove(t){this.draw(t)}handleMouseUp(){this.stopDrawing()}handleTouchStart(t){this.startDrawing(t)}handleTouchMove(t){this.draw(t)}handleTouchEnd(){this.stopDrawing()}startDrawing(t){this.isDrawing=!0;const s=n(this.canvas,t);[this.lastX,this.lastY]=[s.x,s.y],this.drawingBoard.onStartDrawing&&this.drawingBoard.onStartDrawing(s.x,s.y)}draw(t){if(!this.isDrawing)return;t.preventDefault();const s=n(this.canvas,t);this.drawingBoard.drawLine(this.lastX,this.lastY,s.x,s.y),[this.lastX,this.lastY]=[s.x,s.y],this.drawingBoard.onDrawing&&this.drawingBoard.onDrawing(s.x,s.y)}stopDrawing(){this.isDrawing=!1,this.drawingBoard.onStopDrawing&&this.drawingBoard.onStopDrawing()}preventDefaultTouch(t){t.preventDefault()}destroy(){this.canvas.replaceWith(this.canvas.cloneNode(!0))}}class e{constructor(t,n){this.drawingBoard=t,this.container=n,this.currentTool="brush",this.toolElements=new Map,this.initTools(),this.createToolbar(),this.bindToolEvents()}initTools(){this.tools={brush:{name:"画笔",color:"#e74c3c",size:5,cursor:"crosshair"},eraser:{name:"橡皮擦",color:"white",size:20,cursor:"crosshair"}}}createToolbar(){const t=document.createElement("div");t.className="canvas-drawing-toolbar",t.innerHTML='\n            <button class="canvas-tool-btn active" data-tool="brush">画笔</button>\n            <button class="canvas-tool-btn" data-tool="eraser">橡皮擦</button>\n            <input type="color" class="canvas-color-picker" value="#e74c3c">\n            <div class="canvas-brush-size">\n                <span>粗细:</span>\n                <input type="range" class="canvas-size-slider" min="1" max="50" value="5">\n                <span class="canvas-size-value">5px</span>\n            </div>\n            <button class="canvas-tool-btn" id="canvas-clear-btn">清空</button>\n            <button class="canvas-tool-btn" id="canvas-save-btn">保存</button>\n        ',this.container.insertBefore(t,this.container.firstChild),this.toolElements.set("brush",t.querySelector('[data-tool="brush"]')),this.toolElements.set("eraser",t.querySelector('[data-tool="eraser"]')),this.colorPicker=t.querySelector(".canvas-color-picker"),this.sizeSlider=t.querySelector(".canvas-size-slider"),this.sizeValue=t.querySelector(".canvas-size-value")}bindToolEvents(){this.toolElements.forEach((t,n)=>{t.addEventListener("click",()=>{this.setCurrentTool(n)})}),this.colorPicker.addEventListener("input",t=>{this.tools.brush.color=t.target.value,"brush"===this.currentTool&&this.drawingBoard.setTool(this.tools.brush)}),this.sizeSlider.addEventListener("input",t=>{const n=parseInt(t.target.value);this.tools.brush.size=n,this.sizeValue.textContent=n+"px","brush"===this.currentTool&&this.drawingBoard.setTool(this.tools.brush)}),this.container.querySelector("#canvas-clear-btn").addEventListener("click",()=>{this.drawingBoard.clearCanvas()}),this.container.querySelector("#canvas-save-btn").addEventListener("click",()=>{this.drawingBoard.saveImage()})}setCurrentTool(t){this.tools[t]&&(this.currentTool=t,this.toolElements.forEach((n,s)=>{n.classList.toggle("active",s===t)}),this.drawingBoard.setTool(this.tools[t]))}getCurrentTool(){return this.tools[this.currentTool]}destroy(){const t=this.container.querySelector(".canvas-drawing-toolbar");t&&t.remove()}}class i{constructor(t,n={}){if(this.container="string"==typeof t?document.getElementById(t):t,!this.container)throw new Error(`Container with id "${t}" not found`);this.options={width:n.width||800,height:n.height||500,backgroundColor:n.backgroundColor||"#ffffff",showToolbar:!1!==n.showToolbar,...n},this.currentTool=null,this.isDestroyed=!1,this.init()}init(){this.createCanvas(),this.initCanvas(),this.options.showToolbar&&(this.toolManager=new e(this,this.container)),this.eventHandler=new s(this.canvas,this),this.bindKeyboardEvents()}createCanvas(){this.canvas=document.createElement("canvas"),this.canvas.width=this.options.width,this.canvas.height=this.options.height,this.canvas.className="canvas-drawing-canvas",this.canvas.style.cursor="crosshair",this.container.innerHTML="",this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d")}initCanvas(){this.ctx.fillStyle=this.options.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.lineJoin="round",this.ctx.lineCap="round",this.setTool({color:"#e74c3c",size:5})}setTool(t){this.currentTool=t}drawLine(t,n,s,e){this.isDestroyed||(this.ctx.beginPath(),this.ctx.moveTo(t,n),this.ctx.lineTo(s,e),this.ctx.strokeStyle=this.currentTool.color,this.ctx.lineWidth=this.currentTool.size,this.ctx.stroke())}clearCanvas(){this.isDestroyed||(this.ctx.fillStyle=this.options.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height))}saveImage(t=`drawing-${(new Date).getTime()}.png`){if(this.isDestroyed)return;((t,n)=>{const s=document.createElement("a");s.download=n,s.href=t,s.click()})(this.canvas.toDataURL("image/png"),t)}getDataUrl(t="image/png",n=1){return this.isDestroyed?"":this.canvas.toDataURL(t,n)}setSize(t,n){if(this.isDestroyed)return;const s=this.getDataUrl();this.canvas.width=t,this.canvas.height=n;const e=new Image;e.onload=()=>{this.ctx.fillStyle=this.options.backgroundColor,this.ctx.fillRect(0,0,t,n),this.ctx.drawImage(e,0,0)},e.src=s}setBackgroundColor(t){if(this.isDestroyed)return;this.options.backgroundColor=t;const n=this.getDataUrl();this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const s=new Image;s.onload=()=>{this.ctx.drawImage(s,0,0)},s.src=n}bindKeyboardEvents(){this.keyboardHandler=t=>{this.isDestroyed||(this.toolManager&&("b"!==t.key&&"B"!==t.key||(t.preventDefault(),this.toolManager.setCurrentTool("brush")),"e"!==t.key&&"E"!==t.key||(t.preventDefault(),this.toolManager.setCurrentTool("eraser"))),"Delete"===t.key&&(t.preventDefault(),this.clearCanvas()))},document.addEventListener("keydown",this.keyboardHandler)}onStartDrawing(t,n){}onDrawing(t,n){}onStopDrawing(){}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.eventHandler&&this.eventHandler.destroy(),this.toolManager&&this.toolManager.destroy(),this.keyboardHandler&&document.removeEventListener("keydown",this.keyboardHandler),this.container.innerHTML="")}}t.DrawingBoard=i,t.createDrawingBoard=function(t,n={}){return function(){if(document.querySelector("#canvas-drawing-tool-styles"))return;const t=document.createElement("style");t.id="canvas-drawing-tool-styles",t.textContent="\n.canvas-drawing-toolbar {\n    background: #2c3e50;\n    padding: 15px;\n    display: flex;\n    align-items: center;\n    gap: 15px;\n    flex-wrap: wrap;\n    border-bottom: 1px solid #34495e;\n}\n\n.canvas-tool-btn {\n    background: #34495e;\n    border: none;\n    color: white;\n    padding: 8px 15px;\n    border-radius: 5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    font-family: inherit;\n    font-size: 14px;\n}\n\n.canvas-tool-btn:hover {\n    background: #4a6572;\n    transform: translateY(-2px);\n}\n\n.canvas-tool-btn.active {\n    background: #e74c3c;\n    box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);\n}\n\n.canvas-color-picker {\n    width: 40px;\n    height: 40px;\n    border: none;\n    border-radius: 5px;\n    cursor: pointer;\n    padding: 0;\n}\n\n.canvas-brush-size {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    color: white;\n    font-size: 14px;\n}\n\n.canvas-size-slider {\n    width: 100px;\n}\n\n.canvas-drawing-canvas {\n    background: white;\n    border-radius: 0 0 8px 8px;\n    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);\n    cursor: crosshair;\n    display: block;\n}\n",document.head.appendChild(t)}(),new i(t,n)}});
//# sourceMappingURL=canvas-drawing-tool.umd.js.map
