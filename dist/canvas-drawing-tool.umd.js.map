{"version":3,"file":"canvas-drawing-tool.umd.js","sources":["../src/utils.js","../src/event-handler.js","../src/tool-manager.js","../src/drawing-board.js","../src/index.js"],"sourcesContent":["/**\r\n * 工具函数模块\r\n */\r\n\r\n/**\r\n * 获取鼠标/触摸在画布上的坐标\r\n * @param {HTMLCanvasElement} canvas - 画布元素\r\n * @param {Event} e - 事件对象\r\n * @returns {Object} 坐标对象 {x, y}\r\n */\r\nexport const getCanvasPosition = (canvas, e) => {\r\n    const rect = canvas.getBoundingClientRect();\r\n    let clientX, clientY;\r\n    \r\n    if (e.type.includes('touch')) {\r\n        clientX = e.touches[0].clientX;\r\n        clientY = e.touches[0].clientY;\r\n    } else {\r\n        clientX = e.clientX;\r\n        clientY = e.clientY;\r\n    }\r\n    \r\n    return {\r\n        x: clientX - rect.left,\r\n        y: clientY - rect.top\r\n    };\r\n};\r\n\r\n/**\r\n * 防抖函数\r\n * @param {Function} func - 要防抖的函数\r\n * @param {number} delay - 延迟时间\r\n * @returns {Function} 防抖后的函数\r\n */\r\nexport const debounce = (func, delay) => {\r\n    let timeoutId;\r\n    return (...args) => {\r\n        clearTimeout(timeoutId);\r\n        timeoutId = setTimeout(() => func.apply(this, args), delay);\r\n    };\r\n};\r\n\r\n/**\r\n * 生成随机颜色\r\n * @returns {string} 十六进制颜色值\r\n */\r\nexport const generateRandomColor = () => {\r\n    return `#${Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0')}`;\r\n};\r\n\r\n/**\r\n * 下载数据URL为文件\r\n * @param {string} dataUrl - 数据URL\r\n * @param {string} filename - 文件名\r\n */\r\nexport const downloadDataUrl = (dataUrl, filename) => {\r\n    const link = document.createElement('a');\r\n    link.download = filename;\r\n    link.href = dataUrl;\r\n    link.click();\r\n};\r\n\r\n/**\r\n * 创建DOM元素\r\n * @param {string} tag - 标签名\r\n * @param {Object} options - 选项\r\n * @returns {HTMLElement} DOM元素\r\n */\r\nexport const createElement = (tag, options = {}) => {\r\n    const element = document.createElement(tag);\r\n    \r\n    if (options.className) {\r\n        element.className = options.className;\r\n    }\r\n    \r\n    if (options.innerHTML) {\r\n        element.innerHTML = options.innerHTML;\r\n    }\r\n    \r\n    if (options.attrs) {\r\n        Object.keys(options.attrs).forEach(key => {\r\n            element.setAttribute(key, options.attrs[key]);\r\n        });\r\n    }\r\n    \r\n    if (options.style) {\r\n        Object.assign(element.style, options.style);\r\n    }\r\n    \r\n    return element;\r\n};\r\n","import { getCanvasPosition } from './utils.js';\r\n\r\n/**\r\n * 事件处理器类\r\n */\r\nexport class EventHandler {\r\n    constructor(canvas, drawingBoard) {\r\n        this.canvas = canvas;\r\n        this.drawingBoard = drawingBoard;\r\n        this.isDrawing = false;\r\n        this.lastX = 0;\r\n        this.lastY = 0;\r\n        \r\n        this.bindEvents();\r\n    }\r\n    \r\n    /**\r\n     * 绑定所有事件\r\n     */\r\n    bindEvents() {\r\n        // 鼠标事件\r\n        this.canvas.addEventListener('mousedown', this.handleMouseDown.bind(this));\r\n        this.canvas.addEventListener('mousemove', this.handleMouseMove.bind(this));\r\n        this.canvas.addEventListener('mouseup', this.handleMouseUp.bind(this));\r\n        this.canvas.addEventListener('mouseout', this.handleMouseUp.bind(this));\r\n        \r\n        // 触摸事件\r\n        this.canvas.addEventListener('touchstart', this.handleTouchStart.bind(this));\r\n        this.canvas.addEventListener('touchmove', this.handleTouchMove.bind(this));\r\n        this.canvas.addEventListener('touchend', this.handleTouchEnd.bind(this));\r\n        \r\n        // 阻止触摸事件的默认行为\r\n        this.canvas.addEventListener('touchstart', this.preventDefaultTouch);\r\n        this.canvas.addEventListener('touchmove', this.preventDefaultTouch);\r\n    }\r\n    \r\n    handleMouseDown(e) {\r\n        this.startDrawing(e);\r\n    }\r\n    \r\n    handleMouseMove(e) {\r\n        this.draw(e);\r\n    }\r\n    \r\n    handleMouseUp() {\r\n        this.stopDrawing();\r\n    }\r\n    \r\n    handleTouchStart(e) {\r\n        this.startDrawing(e);\r\n    }\r\n    \r\n    handleTouchMove(e) {\r\n        this.draw(e);\r\n    }\r\n    \r\n    handleTouchEnd() {\r\n        this.stopDrawing();\r\n    }\r\n    \r\n    startDrawing(e) {\r\n        this.isDrawing = true;\r\n        const pos = getCanvasPosition(this.canvas, e);\r\n        [this.lastX, this.lastY] = [pos.x, pos.y];\r\n        \r\n        if (this.drawingBoard.onStartDrawing) {\r\n            this.drawingBoard.onStartDrawing(pos.x, pos.y);\r\n        }\r\n    }\r\n    \r\n    draw(e) {\r\n        if (!this.isDrawing) return;\r\n        \r\n        e.preventDefault();\r\n        const pos = getCanvasPosition(this.canvas, e);\r\n        \r\n        this.drawingBoard.drawLine(this.lastX, this.lastY, pos.x, pos.y);\r\n        [this.lastX, this.lastY] = [pos.x, pos.y];\r\n        \r\n        if (this.drawingBoard.onDrawing) {\r\n            this.drawingBoard.onDrawing(pos.x, pos.y);\r\n        }\r\n    }\r\n    \r\n    stopDrawing() {\r\n        this.isDrawing = false;\r\n        if (this.drawingBoard.onStopDrawing) {\r\n            this.drawingBoard.onStopDrawing();\r\n        }\r\n    }\r\n    \r\n    preventDefaultTouch(e) {\r\n        e.preventDefault();\r\n    }\r\n    \r\n    /**\r\n     * 销毁事件处理器\r\n     */\r\n    destroy() {\r\n        // 移除所有事件监听器\r\n        this.canvas.replaceWith(this.canvas.cloneNode(true));\r\n    }\r\n}\r\n","/**\r\n * 工具管理器类\r\n */\r\nexport class ToolManager {\r\n    constructor(drawingBoard, container) {\r\n        this.drawingBoard = drawingBoard;\r\n        this.container = container;\r\n        this.currentTool = 'brush';\r\n        this.toolElements = new Map();\r\n        \r\n        this.initTools();\r\n        this.createToolbar();\r\n        this.bindToolEvents();\r\n    }\r\n    \r\n    /**\r\n     * 初始化工具配置\r\n     */\r\n    initTools() {\r\n        this.tools = {\r\n            brush: {\r\n                name: '画笔',\r\n                color: '#e74c3c',\r\n                size: 5,\r\n                cursor: 'crosshair'\r\n            },\r\n            eraser: {\r\n                name: '橡皮擦',\r\n                color: 'white',\r\n                size: 20,\r\n                cursor: 'crosshair'\r\n            }\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * 创建工具栏\r\n     */\r\n    createToolbar() {\r\n        const toolbar = document.createElement('div');\r\n        toolbar.className = 'canvas-drawing-toolbar';\r\n        toolbar.innerHTML = `\r\n            <button class=\"canvas-tool-btn active\" data-tool=\"brush\">画笔</button>\r\n            <button class=\"canvas-tool-btn\" data-tool=\"eraser\">橡皮擦</button>\r\n            <input type=\"color\" class=\"canvas-color-picker\" value=\"#e74c3c\">\r\n            <div class=\"canvas-brush-size\">\r\n                <span>粗细:</span>\r\n                <input type=\"range\" class=\"canvas-size-slider\" min=\"1\" max=\"50\" value=\"5\">\r\n                <span class=\"canvas-size-value\">5px</span>\r\n            </div>\r\n            <button class=\"canvas-tool-btn\" id=\"canvas-clear-btn\">清空</button>\r\n            <button class=\"canvas-tool-btn\" id=\"canvas-save-btn\">保存</button>\r\n        `;\r\n        \r\n        this.container.insertBefore(toolbar, this.container.firstChild);\r\n        \r\n        // 缓存工具元素\r\n        this.toolElements.set('brush', toolbar.querySelector('[data-tool=\"brush\"]'));\r\n        this.toolElements.set('eraser', toolbar.querySelector('[data-tool=\"eraser\"]'));\r\n        this.colorPicker = toolbar.querySelector('.canvas-color-picker');\r\n        this.sizeSlider = toolbar.querySelector('.canvas-size-slider');\r\n        this.sizeValue = toolbar.querySelector('.canvas-size-value');\r\n    }\r\n    \r\n    /**\r\n     * 绑定工具事件\r\n     */\r\n    bindToolEvents() {\r\n        // 工具按钮点击事件\r\n        this.toolElements.forEach((element, toolName) => {\r\n            element.addEventListener('click', () => {\r\n                this.setCurrentTool(toolName);\r\n            });\r\n        });\r\n        \r\n        // 颜色选择器\r\n        this.colorPicker.addEventListener('input', (e) => {\r\n            this.tools.brush.color = e.target.value;\r\n            if (this.currentTool === 'brush') {\r\n                this.drawingBoard.setTool(this.tools.brush);\r\n            }\r\n        });\r\n        \r\n        // 画笔大小调节\r\n        this.sizeSlider.addEventListener('input', (e) => {\r\n            const size = parseInt(e.target.value);\r\n            this.tools.brush.size = size;\r\n            this.sizeValue.textContent = size + 'px';\r\n            \r\n            if (this.currentTool === 'brush') {\r\n                this.drawingBoard.setTool(this.tools.brush);\r\n            }\r\n        });\r\n        \r\n        // 清空按钮\r\n        this.container.querySelector('#canvas-clear-btn').addEventListener('click', () => {\r\n            this.drawingBoard.clearCanvas();\r\n        });\r\n        \r\n        // 保存按钮\r\n        this.container.querySelector('#canvas-save-btn').addEventListener('click', () => {\r\n            this.drawingBoard.saveImage();\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * 设置当前工具\r\n     */\r\n    setCurrentTool(toolName) {\r\n        if (!this.tools[toolName]) return;\r\n        \r\n        this.currentTool = toolName;\r\n        \r\n        // 更新按钮状态\r\n        this.toolElements.forEach((element, name) => {\r\n            element.classList.toggle('active', name === toolName);\r\n        });\r\n        \r\n        // 更新画板工具设置\r\n        this.drawingBoard.setTool(this.tools[toolName]);\r\n    }\r\n    \r\n    /**\r\n     * 获取当前工具配置\r\n     */\r\n    getCurrentTool() {\r\n        return this.tools[this.currentTool];\r\n    }\r\n    \r\n    /**\r\n     * 销毁工具栏\r\n     */\r\n    destroy() {\r\n        const toolbar = this.container.querySelector('.canvas-drawing-toolbar');\r\n        if (toolbar) {\r\n            toolbar.remove();\r\n        }\r\n    }\r\n}\r\n","import { EventHandler } from './event-handler.js';\r\nimport { ToolManager } from './tool-manager.js';\r\nimport { downloadDataUrl } from './utils.js';\r\n\r\n/**\r\n * 画板核心类\r\n */\r\nexport class DrawingBoard {\r\n    constructor(containerId, options = {}) {\r\n        this.container = typeof containerId === 'string' \r\n            ? document.getElementById(containerId) \r\n            : containerId;\r\n        \r\n        if (!this.container) {\r\n            throw new Error(`Container with id \"${containerId}\" not found`);\r\n        }\r\n        \r\n        this.options = {\r\n            width: options.width || 800,\r\n            height: options.height || 500,\r\n            backgroundColor: options.backgroundColor || '#ffffff',\r\n            showToolbar: options.showToolbar !== false,\r\n            ...options\r\n        };\r\n        \r\n        this.currentTool = null;\r\n        this.isDestroyed = false;\r\n        \r\n        this.init();\r\n    }\r\n    \r\n    /**\r\n     * 初始化画板\r\n     */\r\n    init() {\r\n        this.createCanvas();\r\n        this.initCanvas();\r\n        \r\n        if (this.options.showToolbar) {\r\n            this.toolManager = new ToolManager(this, this.container);\r\n        }\r\n        \r\n        this.eventHandler = new EventHandler(this.canvas, this);\r\n        this.bindKeyboardEvents();\r\n    }\r\n    \r\n    /**\r\n     * 创建画布元素\r\n     */\r\n    createCanvas() {\r\n        this.canvas = document.createElement('canvas');\r\n        this.canvas.width = this.options.width;\r\n        this.canvas.height = this.options.height;\r\n        this.canvas.className = 'canvas-drawing-canvas';\r\n        this.canvas.style.cursor = 'crosshair';\r\n        \r\n        // 清空容器并添加画布\r\n        this.container.innerHTML = '';\r\n        this.container.appendChild(this.canvas);\r\n        \r\n        this.ctx = this.canvas.getContext('2d');\r\n    }\r\n    \r\n    /**\r\n     * 初始化画布设置\r\n     */\r\n    initCanvas() {\r\n        // 设置画布背景\r\n        this.ctx.fillStyle = this.options.backgroundColor;\r\n        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n        \r\n        // 设置线条样式\r\n        this.ctx.lineJoin = 'round';\r\n        this.ctx.lineCap = 'round';\r\n        \r\n        // 设置默认工具\r\n        this.setTool({\r\n            color: '#e74c3c',\r\n            size: 5\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * 设置当前工具\r\n     */\r\n    setTool(toolConfig) {\r\n        this.currentTool = toolConfig;\r\n    }\r\n    \r\n    /**\r\n     * 绘制线条\r\n     */\r\n    drawLine(startX, startY, endX, endY) {\r\n        if (this.isDestroyed) return;\r\n        \r\n        this.ctx.beginPath();\r\n        this.ctx.moveTo(startX, startY);\r\n        this.ctx.lineTo(endX, endY);\r\n        \r\n        this.ctx.strokeStyle = this.currentTool.color;\r\n        this.ctx.lineWidth = this.currentTool.size;\r\n        this.ctx.stroke();\r\n    }\r\n    \r\n    /**\r\n     * 清空画布\r\n     */\r\n    clearCanvas() {\r\n        if (this.isDestroyed) return;\r\n        \r\n        this.ctx.fillStyle = this.options.backgroundColor;\r\n        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n    }\r\n    \r\n    /**\r\n     * 保存图片\r\n     */\r\n    saveImage(filename = `drawing-${new Date().getTime()}.png`) {\r\n        if (this.isDestroyed) return;\r\n        \r\n        const dataUrl = this.canvas.toDataURL('image/png');\r\n        downloadDataUrl(dataUrl, filename);\r\n    }\r\n    \r\n    /**\r\n     * 获取画布数据URL\r\n     */\r\n    getDataUrl(type = 'image/png', quality = 1) {\r\n        if (this.isDestroyed) return '';\r\n        return this.canvas.toDataURL(type, quality);\r\n    }\r\n    \r\n    /**\r\n     * 设置画布尺寸\r\n     */\r\n    setSize(width, height) {\r\n        if (this.isDestroyed) return;\r\n        \r\n        // 保存当前内容\r\n        const currentImage = this.getDataUrl();\r\n        \r\n        // 调整画布尺寸\r\n        this.canvas.width = width;\r\n        this.canvas.height = height;\r\n        \r\n        // 重新绘制内容\r\n        const img = new Image();\r\n        img.onload = () => {\r\n            this.ctx.fillStyle = this.options.backgroundColor;\r\n            this.ctx.fillRect(0, 0, width, height);\r\n            this.ctx.drawImage(img, 0, 0);\r\n        };\r\n        img.src = currentImage;\r\n    }\r\n    \r\n    /**\r\n     * 设置背景颜色\r\n     */\r\n    setBackgroundColor(color) {\r\n        if (this.isDestroyed) return;\r\n        \r\n        this.options.backgroundColor = color;\r\n        const currentImage = this.getDataUrl();\r\n        \r\n        this.ctx.fillStyle = color;\r\n        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n        \r\n        const img = new Image();\r\n        img.onload = () => {\r\n            this.ctx.drawImage(img, 0, 0);\r\n        };\r\n        img.src = currentImage;\r\n    }\r\n    \r\n    /**\r\n     * 绑定键盘事件\r\n     */\r\n    bindKeyboardEvents() {\r\n        this.keyboardHandler = (e) => {\r\n            if (this.isDestroyed) return;\r\n            \r\n            if (this.toolManager) {\r\n                // B 键切换画笔\r\n                if (e.key === 'b' || e.key === 'B') {\r\n                    e.preventDefault();\r\n                    this.toolManager.setCurrentTool('brush');\r\n                }\r\n                \r\n                // E 键切换橡皮擦\r\n                if (e.key === 'e' || e.key === 'E') {\r\n                    e.preventDefault();\r\n                    this.toolManager.setCurrentTool('eraser');\r\n                }\r\n            }\r\n            \r\n            // Delete 键清空画布\r\n            if (e.key === 'Delete') {\r\n                e.preventDefault();\r\n                this.clearCanvas();\r\n            }\r\n        };\r\n        \r\n        document.addEventListener('keydown', this.keyboardHandler);\r\n    }\r\n    \r\n    /**\r\n     * 事件回调\r\n     */\r\n    onStartDrawing(x, y) {\r\n        // 可由外部重写\r\n    }\r\n    \r\n    onDrawing(x, y) {\r\n        // 可由外部重写\r\n    }\r\n    \r\n    onStopDrawing() {\r\n        // 可由外部重写\r\n    }\r\n    \r\n    /**\r\n     * 销毁画板，清理资源\r\n     */\r\n    destroy() {\r\n        if (this.isDestroyed) return;\r\n        \r\n        this.isDestroyed = true;\r\n        \r\n        if (this.eventHandler) {\r\n            this.eventHandler.destroy();\r\n        }\r\n        \r\n        if (this.toolManager) {\r\n            this.toolManager.destroy();\r\n        }\r\n        \r\n        if (this.keyboardHandler) {\r\n            document.removeEventListener('keydown', this.keyboardHandler);\r\n        }\r\n        \r\n        this.container.innerHTML = '';\r\n    }\r\n}\r\n","import { DrawingBoard } from './drawing-board.js';\r\n\r\n// 默认样式\r\nconst defaultStyles = `\r\n.canvas-drawing-toolbar {\r\n    background: #2c3e50;\r\n    padding: 15px;\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 15px;\r\n    flex-wrap: wrap;\r\n    border-bottom: 1px solid #34495e;\r\n}\r\n\r\n.canvas-tool-btn {\r\n    background: #34495e;\r\n    border: none;\r\n    color: white;\r\n    padding: 8px 15px;\r\n    border-radius: 5px;\r\n    cursor: pointer;\r\n    transition: all 0.3s ease;\r\n    font-family: inherit;\r\n    font-size: 14px;\r\n}\r\n\r\n.canvas-tool-btn:hover {\r\n    background: #4a6572;\r\n    transform: translateY(-2px);\r\n}\r\n\r\n.canvas-tool-btn.active {\r\n    background: #e74c3c;\r\n    box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);\r\n}\r\n\r\n.canvas-color-picker {\r\n    width: 40px;\r\n    height: 40px;\r\n    border: none;\r\n    border-radius: 5px;\r\n    cursor: pointer;\r\n    padding: 0;\r\n}\r\n\r\n.canvas-brush-size {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 10px;\r\n    color: white;\r\n    font-size: 14px;\r\n}\r\n\r\n.canvas-size-slider {\r\n    width: 100px;\r\n}\r\n\r\n.canvas-drawing-canvas {\r\n    background: white;\r\n    border-radius: 0 0 8px 8px;\r\n    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);\r\n    cursor: crosshair;\r\n    display: block;\r\n}\r\n`;\r\n\r\n/**\r\n * 注入默认样式\r\n */\r\nfunction injectStyles() {\r\n    if (document.querySelector('#canvas-drawing-tool-styles')) return;\r\n    \r\n    const style = document.createElement('style');\r\n    style.id = 'canvas-drawing-tool-styles';\r\n    style.textContent = defaultStyles;\r\n    document.head.appendChild(style);\r\n}\r\n\r\n/**\r\n * 创建画板实例\r\n * @param {string|HTMLElement} containerId - 容器ID或元素\r\n * @param {Object} options - 配置选项\r\n * @returns {DrawingBoard} 画板实例\r\n */\r\nexport function createDrawingBoard(containerId, options = {}) {\r\n    injectStyles();\r\n    return new DrawingBoard(containerId, options);\r\n}\r\n\r\n/**\r\n * 默认导出\r\n */\r\nexport { DrawingBoard };\r\n"],"names":["getCanvasPosition","canvas","e","rect","getBoundingClientRect","clientX","clientY","type","includes","touches","x","left","y","top","EventHandler","constructor","drawingBoard","this","isDrawing","lastX","lastY","bindEvents","addEventListener","handleMouseDown","bind","handleMouseMove","handleMouseUp","handleTouchStart","handleTouchMove","handleTouchEnd","preventDefaultTouch","startDrawing","draw","stopDrawing","pos","onStartDrawing","preventDefault","drawLine","onDrawing","onStopDrawing","destroy","replaceWith","cloneNode","ToolManager","container","currentTool","toolElements","Map","initTools","createToolbar","bindToolEvents","tools","brush","name","color","size","cursor","eraser","toolbar","document","createElement","className","innerHTML","insertBefore","firstChild","set","querySelector","colorPicker","sizeSlider","sizeValue","forEach","element","toolName","setCurrentTool","target","value","setTool","parseInt","textContent","clearCanvas","saveImage","classList","toggle","getCurrentTool","remove","DrawingBoard","containerId","options","getElementById","Error","width","height","backgroundColor","showToolbar","isDestroyed","init","createCanvas","initCanvas","toolManager","eventHandler","bindKeyboardEvents","style","appendChild","ctx","getContext","fillStyle","fillRect","lineJoin","lineCap","toolConfig","startX","startY","endX","endY","beginPath","moveTo","lineTo","strokeStyle","lineWidth","stroke","filename","Date","getTime","dataUrl","link","download","href","click","downloadDataUrl","toDataURL","getDataUrl","quality","setSize","currentImage","img","Image","onload","drawImage","src","setBackgroundColor","keyboardHandler","key","removeEventListener","id","head","injectStyles"],"mappings":"wPAUO,MAAMA,EAAoB,CAACC,EAAQC,KACtC,MAAMC,EAAOF,EAAOG,wBACpB,IAAIC,EAASC,EAUb,OARIJ,EAAEK,KAAKC,SAAS,UAChBH,EAAUH,EAAEO,QAAQ,GAAGJ,QACvBC,EAAUJ,EAAEO,QAAQ,GAAGH,UAEvBD,EAAUH,EAAEG,QACZC,EAAUJ,EAAEI,SAGT,CACHI,EAAGL,EAAUF,EAAKQ,KAClBC,EAAGN,EAAUH,EAAKU,MCnBnB,MAAMC,EACT,WAAAC,CAAYd,EAAQe,GAChBC,KAAKhB,OAASA,EACdgB,KAAKD,aAAeA,EACpBC,KAAKC,WAAY,EACjBD,KAAKE,MAAQ,EACbF,KAAKG,MAAQ,EAEbH,KAAKI,YACR,CAKD,UAAAA,GAEIJ,KAAKhB,OAAOqB,iBAAiB,YAAaL,KAAKM,gBAAgBC,KAAKP,OACpEA,KAAKhB,OAAOqB,iBAAiB,YAAaL,KAAKQ,gBAAgBD,KAAKP,OACpEA,KAAKhB,OAAOqB,iBAAiB,UAAWL,KAAKS,cAAcF,KAAKP,OAChEA,KAAKhB,OAAOqB,iBAAiB,WAAYL,KAAKS,cAAcF,KAAKP,OAGjEA,KAAKhB,OAAOqB,iBAAiB,aAAcL,KAAKU,iBAAiBH,KAAKP,OACtEA,KAAKhB,OAAOqB,iBAAiB,YAAaL,KAAKW,gBAAgBJ,KAAKP,OACpEA,KAAKhB,OAAOqB,iBAAiB,WAAYL,KAAKY,eAAeL,KAAKP,OAGlEA,KAAKhB,OAAOqB,iBAAiB,aAAcL,KAAKa,qBAChDb,KAAKhB,OAAOqB,iBAAiB,YAAaL,KAAKa,oBAClD,CAED,eAAAP,CAAgBrB,GACZe,KAAKc,aAAa7B,EACrB,CAED,eAAAuB,CAAgBvB,GACZe,KAAKe,KAAK9B,EACb,CAED,aAAAwB,GACIT,KAAKgB,aACR,CAED,gBAAAN,CAAiBzB,GACbe,KAAKc,aAAa7B,EACrB,CAED,eAAA0B,CAAgB1B,GACZe,KAAKe,KAAK9B,EACb,CAED,cAAA2B,GACIZ,KAAKgB,aACR,CAED,YAAAF,CAAa7B,GACTe,KAAKC,WAAY,EACjB,MAAMgB,EAAMlC,EAAkBiB,KAAKhB,OAAQC,IAC1Ce,KAAKE,MAAOF,KAAKG,OAAS,CAACc,EAAIxB,EAAGwB,EAAItB,GAEnCK,KAAKD,aAAamB,gBAClBlB,KAAKD,aAAamB,eAAeD,EAAIxB,EAAGwB,EAAItB,EAEnD,CAED,IAAAoB,CAAK9B,GACD,IAAKe,KAAKC,UAAW,OAErBhB,EAAEkC,iBACF,MAAMF,EAAMlC,EAAkBiB,KAAKhB,OAAQC,GAE3Ce,KAAKD,aAAaqB,SAASpB,KAAKE,MAAOF,KAAKG,MAAOc,EAAIxB,EAAGwB,EAAItB,IAC7DK,KAAKE,MAAOF,KAAKG,OAAS,CAACc,EAAIxB,EAAGwB,EAAItB,GAEnCK,KAAKD,aAAasB,WAClBrB,KAAKD,aAAasB,UAAUJ,EAAIxB,EAAGwB,EAAItB,EAE9C,CAED,WAAAqB,GACIhB,KAAKC,WAAY,EACbD,KAAKD,aAAauB,eAClBtB,KAAKD,aAAauB,eAEzB,CAED,mBAAAT,CAAoB5B,GAChBA,EAAEkC,gBACL,CAKD,OAAAI,GAEIvB,KAAKhB,OAAOwC,YAAYxB,KAAKhB,OAAOyC,WAAU,GACjD,EClGE,MAAMC,EACT,WAAA5B,CAAYC,EAAc4B,GACtB3B,KAAKD,aAAeA,EACpBC,KAAK2B,UAAYA,EACjB3B,KAAK4B,YAAc,QACnB5B,KAAK6B,aAAe,IAAIC,IAExB9B,KAAK+B,YACL/B,KAAKgC,gBACLhC,KAAKiC,gBACR,CAKD,SAAAF,GACI/B,KAAKkC,MAAQ,CACTC,MAAO,CACHC,KAAM,KACNC,MAAO,UACPC,KAAM,EACNC,OAAQ,aAEZC,OAAQ,CACJJ,KAAM,MACNC,MAAO,QACPC,KAAM,GACNC,OAAQ,aAGnB,CAKD,aAAAP,GACI,MAAMS,EAAUC,SAASC,cAAc,OACvCF,EAAQG,UAAY,yBACpBH,EAAQI,UAAY,kpBAapB7C,KAAK2B,UAAUmB,aAAaL,EAASzC,KAAK2B,UAAUoB,YAGpD/C,KAAK6B,aAAamB,IAAI,QAASP,EAAQQ,cAAc,wBACrDjD,KAAK6B,aAAamB,IAAI,SAAUP,EAAQQ,cAAc,yBACtDjD,KAAKkD,YAAcT,EAAQQ,cAAc,wBACzCjD,KAAKmD,WAAaV,EAAQQ,cAAc,uBACxCjD,KAAKoD,UAAYX,EAAQQ,cAAc,qBAC1C,CAKD,cAAAhB,GAEIjC,KAAK6B,aAAawB,QAAQ,CAACC,EAASC,KAChCD,EAAQjD,iBAAiB,QAAS,KAC9BL,KAAKwD,eAAeD,OAK5BvD,KAAKkD,YAAY7C,iBAAiB,QAAUpB,IACxCe,KAAKkC,MAAMC,MAAME,MAAQpD,EAAEwE,OAAOC,MACT,UAArB1D,KAAK4B,aACL5B,KAAKD,aAAa4D,QAAQ3D,KAAKkC,MAAMC,SAK7CnC,KAAKmD,WAAW9C,iBAAiB,QAAUpB,IACvC,MAAMqD,EAAOsB,SAAS3E,EAAEwE,OAAOC,OAC/B1D,KAAKkC,MAAMC,MAAMG,KAAOA,EACxBtC,KAAKoD,UAAUS,YAAcvB,EAAO,KAEX,UAArBtC,KAAK4B,aACL5B,KAAKD,aAAa4D,QAAQ3D,KAAKkC,MAAMC,SAK7CnC,KAAK2B,UAAUsB,cAAc,qBAAqB5C,iBAAiB,QAAS,KACxEL,KAAKD,aAAa+D,gBAItB9D,KAAK2B,UAAUsB,cAAc,oBAAoB5C,iBAAiB,QAAS,KACvEL,KAAKD,aAAagE,aAEzB,CAKD,cAAAP,CAAeD,GACNvD,KAAKkC,MAAMqB,KAEhBvD,KAAK4B,YAAc2B,EAGnBvD,KAAK6B,aAAawB,QAAQ,CAACC,EAASlB,KAChCkB,EAAQU,UAAUC,OAAO,SAAU7B,IAASmB,KAIhDvD,KAAKD,aAAa4D,QAAQ3D,KAAKkC,MAAMqB,IACxC,CAKD,cAAAW,GACI,OAAOlE,KAAKkC,MAAMlC,KAAK4B,YAC1B,CAKD,OAAAL,GACI,MAAMkB,EAAUzC,KAAK2B,UAAUsB,cAAc,2BACzCR,GACAA,EAAQ0B,QAEf,EClIE,MAAMC,EACT,WAAAtE,CAAYuE,EAAaC,EAAU,IAK/B,GAJAtE,KAAK2B,UAAmC,iBAAhB0C,EAClB3B,SAAS6B,eAAeF,GACxBA,GAEDrE,KAAK2B,UACN,MAAM,IAAI6C,MAAM,sBAAsBH,gBAG1CrE,KAAKsE,QAAU,CACXG,MAAOH,EAAQG,OAAS,IACxBC,OAAQJ,EAAQI,QAAU,IAC1BC,gBAAiBL,EAAQK,iBAAmB,UAC5CC,aAAqC,IAAxBN,EAAQM,eAClBN,GAGPtE,KAAK4B,YAAc,KACnB5B,KAAK6E,aAAc,EAEnB7E,KAAK8E,MACR,CAKD,IAAAA,GACI9E,KAAK+E,eACL/E,KAAKgF,aAEDhF,KAAKsE,QAAQM,cACb5E,KAAKiF,YAAc,IAAIvD,EAAY1B,KAAMA,KAAK2B,YAGlD3B,KAAKkF,aAAe,IAAIrF,EAAaG,KAAKhB,OAAQgB,MAClDA,KAAKmF,oBACR,CAKD,YAAAJ,GACI/E,KAAKhB,OAAS0D,SAASC,cAAc,UACrC3C,KAAKhB,OAAOyF,MAAQzE,KAAKsE,QAAQG,MACjCzE,KAAKhB,OAAO0F,OAAS1E,KAAKsE,QAAQI,OAClC1E,KAAKhB,OAAO4D,UAAY,wBACxB5C,KAAKhB,OAAOoG,MAAM7C,OAAS,YAG3BvC,KAAK2B,UAAUkB,UAAY,GAC3B7C,KAAK2B,UAAU0D,YAAYrF,KAAKhB,QAEhCgB,KAAKsF,IAAMtF,KAAKhB,OAAOuG,WAAW,KACrC,CAKD,UAAAP,GAEIhF,KAAKsF,IAAIE,UAAYxF,KAAKsE,QAAQK,gBAClC3E,KAAKsF,IAAIG,SAAS,EAAG,EAAGzF,KAAKhB,OAAOyF,MAAOzE,KAAKhB,OAAO0F,QAGvD1E,KAAKsF,IAAII,SAAW,QACpB1F,KAAKsF,IAAIK,QAAU,QAGnB3F,KAAK2D,QAAQ,CACTtB,MAAO,UACPC,KAAM,GAEb,CAKD,OAAAqB,CAAQiC,GACJ5F,KAAK4B,YAAcgE,CACtB,CAKD,QAAAxE,CAASyE,EAAQC,EAAQC,EAAMC,GACvBhG,KAAK6E,cAET7E,KAAKsF,IAAIW,YACTjG,KAAKsF,IAAIY,OAAOL,EAAQC,GACxB9F,KAAKsF,IAAIa,OAAOJ,EAAMC,GAEtBhG,KAAKsF,IAAIc,YAAcpG,KAAK4B,YAAYS,MACxCrC,KAAKsF,IAAIe,UAAYrG,KAAK4B,YAAYU,KACtCtC,KAAKsF,IAAIgB,SACZ,CAKD,WAAAxC,GACQ9D,KAAK6E,cAET7E,KAAKsF,IAAIE,UAAYxF,KAAKsE,QAAQK,gBAClC3E,KAAKsF,IAAIG,SAAS,EAAG,EAAGzF,KAAKhB,OAAOyF,MAAOzE,KAAKhB,OAAO0F,QAC1D,CAKD,SAAAX,CAAUwC,EAAW,YAAW,IAAIC,MAAOC,iBACvC,GAAIzG,KAAK6E,YAAa,OH/DC,EAAC6B,EAASH,KACrC,MAAMI,EAAOjE,SAASC,cAAc,KACpCgE,EAAKC,SAAWL,EAChBI,EAAKE,KAAOH,EACZC,EAAKG,SG8DDC,CADgB/G,KAAKhB,OAAOgI,UAAU,aACbT,EAC5B,CAKD,UAAAU,CAAW3H,EAAO,YAAa4H,EAAU,GACrC,OAAIlH,KAAK6E,YAAoB,GACtB7E,KAAKhB,OAAOgI,UAAU1H,EAAM4H,EACtC,CAKD,OAAAC,CAAQ1C,EAAOC,GACX,GAAI1E,KAAK6E,YAAa,OAGtB,MAAMuC,EAAepH,KAAKiH,aAG1BjH,KAAKhB,OAAOyF,MAAQA,EACpBzE,KAAKhB,OAAO0F,OAASA,EAGrB,MAAM2C,EAAM,IAAIC,MAChBD,EAAIE,OAAS,KACTvH,KAAKsF,IAAIE,UAAYxF,KAAKsE,QAAQK,gBAClC3E,KAAKsF,IAAIG,SAAS,EAAG,EAAGhB,EAAOC,GAC/B1E,KAAKsF,IAAIkC,UAAUH,EAAK,EAAG,IAE/BA,EAAII,IAAML,CACb,CAKD,kBAAAM,CAAmBrF,GACf,GAAIrC,KAAK6E,YAAa,OAEtB7E,KAAKsE,QAAQK,gBAAkBtC,EAC/B,MAAM+E,EAAepH,KAAKiH,aAE1BjH,KAAKsF,IAAIE,UAAYnD,EACrBrC,KAAKsF,IAAIG,SAAS,EAAG,EAAGzF,KAAKhB,OAAOyF,MAAOzE,KAAKhB,OAAO0F,QAEvD,MAAM2C,EAAM,IAAIC,MAChBD,EAAIE,OAAS,KACTvH,KAAKsF,IAAIkC,UAAUH,EAAK,EAAG,IAE/BA,EAAII,IAAML,CACb,CAKD,kBAAAjC,GACInF,KAAK2H,gBAAmB1I,IAChBe,KAAK6E,cAEL7E,KAAKiF,cAES,MAAVhG,EAAE2I,KAAyB,MAAV3I,EAAE2I,MACnB3I,EAAEkC,iBACFnB,KAAKiF,YAAYzB,eAAe,UAItB,MAAVvE,EAAE2I,KAAyB,MAAV3I,EAAE2I,MACnB3I,EAAEkC,iBACFnB,KAAKiF,YAAYzB,eAAe,YAK1B,WAAVvE,EAAE2I,MACF3I,EAAEkC,iBACFnB,KAAK8D,iBAIbpB,SAASrC,iBAAiB,UAAWL,KAAK2H,gBAC7C,CAKD,cAAAzG,CAAezB,EAAGE,GAEjB,CAED,SAAA0B,CAAU5B,EAAGE,GAEZ,CAED,aAAA2B,GAEC,CAKD,OAAAC,GACQvB,KAAK6E,cAET7E,KAAK6E,aAAc,EAEf7E,KAAKkF,cACLlF,KAAKkF,aAAa3D,UAGlBvB,KAAKiF,aACLjF,KAAKiF,YAAY1D,UAGjBvB,KAAK2H,iBACLjF,SAASmF,oBAAoB,UAAW7H,KAAK2H,iBAGjD3H,KAAK2B,UAAUkB,UAAY,GAC9B,wCC7JE,SAA4BwB,EAAaC,EAAU,IAEtD,OAjBJ,WACI,GAAI5B,SAASO,cAAc,+BAAgC,OAE3D,MAAMmC,EAAQ1C,SAASC,cAAc,SACrCyC,EAAM0C,GAAK,6BACX1C,EAAMvB,YAvEY,goCAwElBnB,SAASqF,KAAK1C,YAAYD,EAC9B,CASI4C,GACO,IAAI5D,EAAaC,EAAaC,EACzC"}